import{a as M,j as t,H as Q,c as L}from"./app-DbC9swOp.js";import{A as I}from"./app-layout-DB38e1tJ.js";import{d as R}from"./dayjs.min-B7ZjrZ6U.js";import{z as q}from"./index-BLROG9a-.js";import{s as Y}from"./index-ikzcNs2d.js";import{b as P,c as F,d as H,e as z}from"./card-DJlYRJMP.js";import{B}from"./badge-B0uBOCG_.js";import{B as D}from"./button-B0cnHsLL.js";import{I as J}from"./input-DV2ZCF-T.js";import{L as $}from"./label-CW24IyLF.js";import{S as E}from"./separator-UedQgQle.js";import"./app-B-j88FTB.js";import"./index-OyaHfcK1.js";import"./index-DrZ1WBgl.js";import"./index-CHXMgrNC.js";import"./utils-CFcDjcb_.js";import"./dialog-XIh-d8In.js";import"./index-GNnbXVu0.js";import"./index-DfdQaTH4.js";import"./index-DUVlDvZK.js";import"./index-DpP96dE-.js";import"./index-CGmkGWeF.js";import"./index-C5noA0MZ.js";import"./index-CFZJ_iCf.js";import"./x-BcxDNo4d.js";import"./createLucideIcon-CwNQQ2Lr.js";import"./tooltip-BjGVwsVz.js";import"./index-DKfa_JjE.js";import"./index-BI2ZCWKw.js";import"./index-BSo9miKG.js";import"./index-vo4ULvVg.js";import"./index-BF2HzXLa.js";import"./avatar-BQA4Z3p_.js";import"./index-CoyZhxZx.js";import"./index-BZB35nAZ.js";import"./index-CMWG4mbA.js";import"./command-RsIjOFqg.js";import"./search-i8E80oUt.js";import"./app-logo-icon-CI-oZLFk.js";import"./layout-grid-DjmK7l_J.js";import"./users-Ba4Nng5e.js";import"./settings-2-DvxrLHlG.js";import"./cpu-H_bfj-VP.js";import"./book-open-DpTjyKmw.js";import"./chevron-right-BLPhb5io.js";import"./appearance-tabs-header-B5XtEuQ0.js";import"./sun-D2aYdR0-.js";const O=(m,e=[])=>{const r=parseFloat(m.point||0);let a=0,o="unanswered";if(e.length===0)return{earnedPoints:a,maxPoints:r,status:o};const i=e[0];switch(m.type){case"true_false":case"multiple_choice":{const l=m.options.find(c=>c.is_correct===1);l&&i.answer_text===l.option_text?(a=r,o="correct"):o="incorrect";break}case"fill_blank":case"short_answer":{m.options.find(c=>c.option_text.trim().toLowerCase()===(i.answer_text||"").trim().toLowerCase())?(a=r,o="correct"):o="review";break}case"matching":{const l=m.options.length,c=l?r/l:0;let p=0;m.options.forEach(d=>{const x=e.find(s=>s.option_id===d.id);x&&x.answer_text===d.match_key&&p++}),a=p*c,o=p===l?"correct":p===0?"incorrect":"partial";break}}return{earnedPoints:+a.toFixed(2),maxPoints:+r.toFixed(2),status:o}},K=m=>{const e={correct:"Correct",incorrect:"Incorrect",partial:"Partially Correct",review:"Needs Review",default:"No Answer"};return t.jsx(B,{children:e[m]||e.default})},U=m=>{const e=L.c(7),{question:r,answers:a}=m;let o;if(e[0]!==a||e[1]!==r.options){let l;e[3]!==a?(l=c=>{const d=a.find(s=>s.option_id===c.id)?.answer_text||"—",x=d===c.match_key;return t.jsx(P,{className:`overflow-hidden ${x?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:t.jsxs(F,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsx("div",{className:"w-full sm:w-1/2 font-medium text-gray-700",children:c.option_text}),t.jsx("div",{className:"hidden sm:block text-gray-400",children:"→"}),t.jsxs("div",{className:"flex w-full sm:w-1/2 flex-col items-end gap-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs font-semibold tracking-wider text-gray-500 uppercase",children:"Student:"}),t.jsx("span",{className:`font-medium ${x?"text-green-700":"text-red-700"}`,children:d})]}),!x&&t.jsxs("div",{className:"rounded bg-green-100 px-2 py-1 text-xs text-green-700",children:["Correct: ",c.match_key]})]})]})},c.id)},e[3]=a,e[4]=l):l=e[4],o=r.options.map(l),e[0]=a,e[1]=r.options,e[2]=o}else o=e[2];let i;return e[5]!==o?(i=t.jsx("div",{className:"mt-4 grid gap-3",children:o}),e[5]=o,e[6]=i):i=e[6],i},W=m=>{const e=L.c(7),{question:r,answers:a}=m,o=a[0]?.answer_text;let i;if(e[0]!==r.options||e[1]!==o){let c;e[3]!==o?(c=p=>{const d=o===p.option_text,x=p.is_correct===1;let s="border-gray-200 bg-white";return d&&x?s="border-green-300 bg-green-50 ring-1 ring-green-300":d&&!x?s="border-red-300 bg-red-50 ring-1 ring-red-300":!d&&x&&(s="border-green-300 bg-white ring-1 ring-green-300 border-dashed"),t.jsx(P,{className:`p-3 transition-all ${s}`,children:t.jsxs(F,{className:"flex items-center gap-3",children:[t.jsx("div",{className:`mr-3 flex h-5 w-5 items-center justify-center rounded-full border ${d?x?"border-green-500 bg-green-500 text-white":"border-red-500 bg-red-500 text-white":"border-gray-300"}`,children:d&&t.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})}),t.jsx("div",{className:`flex-1 ${x?"font-semibold text-gray-900":"text-gray-700"}`,children:p.option_text}),x&&!d&&t.jsx("div",{className:"px-2 text-xs font-medium text-green-600",children:"Correct Answer"})]})},p.id)},e[3]=o,e[4]=c):c=e[4],i=r.options.map(c),e[0]=r.options,e[1]=o,e[2]=i}else i=e[2];let l;return e[5]!==i?(l=t.jsx("div",{className:"mt-4 space-y-2",children:i}),e[5]=i,e[6]=l):l=e[6],l},X=m=>{const e=L.c(32),{question:r,answers:a,onTeacherScore:o}=m,i=a[0]?.answer_text||"",l=r.options.map(V);let c;e[0]!==i?(c=A=>A.trim().toLowerCase()===i.trim().toLowerCase(),e[0]=i,e[1]=c):c=e[1];const p=l.some(c),[d,x]=M.useState(a[0]?.manual_score??""),s=parseFloat(r.point||0);let n;e[2]!==s||e[3]!==o||e[4]!==r.id?(n=A=>{let _=parseFloat(A);isNaN(_)&&(_=""),_>s&&(_=s),_<0&&(_=0),x(_),o?.(r.id,_)},e[2]=s,e[3]=o,e[4]=r.id,e[5]=n):n=e[5];const u=n,f="mt-4 space-y-4";let b;e[6]===Symbol.for("react.memo_cache_sentinel")?(b=t.jsx($,{className:"mb-1",children:"Your Answer"}),e[6]=b):b=e[6];const N=`rounded-md border p-3 ${p?"border-green-200 bg-green-50 text-green-800":"border-red-200 bg-red-50 text-red-800"}`;let h;e[7]!==i?(h=i||t.jsx("em",{className:"text-gray-400",children:"No answer submitted"}),e[7]=i,e[8]=h):h=e[8];let w;e[9]!==N||e[10]!==h?(w=t.jsxs("div",{children:[b,t.jsx("div",{className:N,children:h})]}),e[9]=N,e[10]=h,e[11]=w):w=e[11];const v=!p&&l.length>0&&t.jsxs("div",{children:[t.jsx($,{className:"mb-1 text-green-700",children:"Expected Answer(s)"}),t.jsx(P,{className:"rounded-md border-green-200 bg-white",children:t.jsx(F,{children:t.jsx("ul",{className:"list-inside list-disc",children:l.map(Z)})})})]});let S;e[12]===Symbol.for("react.memo_cache_sentinel")?(S=t.jsx(E,{}),e[12]=S):S=e[12];let g;e[13]!==s?(g=t.jsxs($,{className:"mb-2",children:["Teacher Score (0 - ",s,")"]}),e[13]=s,e[14]=g):g=e[14];let j;e[15]!==u?(j=A=>u(A.target.value),e[15]=u,e[16]=j):j=e[16];let y;e[17]!==d||e[18]!==s||e[19]!==j?(y=t.jsx(J,{type:"number",min:0,max:s,step:.25,value:d,onChange:j,className:"w-32",placeholder:"Enter score"}),e[17]=d,e[18]=s,e[19]=j,e[20]=y):y=e[20];let C;e[21]!==d||e[22]!==s?(C=d!==""&&t.jsxs("p",{className:"mt-1 text-xs text-green-600",children:["Score saved: ",d," / ",s]}),e[21]=d,e[22]=s,e[23]=C):C=e[23];let k;e[24]!==g||e[25]!==y||e[26]!==C?(k=t.jsxs("div",{children:[g,y,C]}),e[24]=g,e[25]=y,e[26]=C,e[27]=k):k=e[27];let T;return e[28]!==k||e[29]!==w||e[30]!==v?(T=t.jsxs("div",{className:f,children:[w,v,S,k]}),e[28]=k,e[29]=w,e[30]=v,e[31]=T):T=e[31],T},G=m=>{const e=L.c(43),{question:r,answers:a,onTeacherScore:o}=m;let i,l,c,p,d,x,s,n,u;if(e[0]!==a||e[1]!==o||e[2]!==r){i=O(r,a);const v=a[0]?.manual_score;l=v??i.earnedPoints;const S=v!=null?"review":i.status;x="flex h-full flex-col",e[12]!==r.question_text?(s=t.jsx("div",{className:"mb-4 text-lg leading-relaxed font-medium text-gray-900",dangerouslySetInnerHTML:{__html:r.question_text}}),e[12]=r.question_text,e[13]=s):s=e[13];let g;e[14]!==a||e[15]!==r?(g=r.type==="matching"&&t.jsx(U,{question:r,answers:a}),e[14]=a,e[15]=r,e[16]=g):g=e[16];let j;e[17]!==a||e[18]!==r?(j=(r.type==="multiple_choice"||r.type==="true_false")&&t.jsx(W,{question:r,answers:a}),e[17]=a,e[18]=r,e[19]=j):j=e[19];const y=(r.type==="short_answer"||r.type==="fill_blank")&&t.jsx(X,{question:r,answers:a,onTeacherScore:o});e[20]!==y||e[21]!==g||e[22]!==j?(n=t.jsxs("div",{className:"flex-grow",children:[g,j,y]}),e[20]=y,e[21]=g,e[22]=j,e[23]=n):n=e[23],e[24]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(E,{}),e[24]=u):u=e[24],d="mt-6 flex items-center justify-between pt-4",c="flex items-center gap-3",p=K(S),e[0]=a,e[1]=o,e[2]=r,e[3]=i,e[4]=l,e[5]=c,e[6]=p,e[7]=d,e[8]=x,e[9]=s,e[10]=n,e[11]=u}else i=e[3],l=e[4],c=e[5],p=e[6],d=e[7],x=e[8],s=e[9],n=e[10],u=e[11];let f;e[25]!==l?(f=t.jsx("span",{className:"font-bold text-gray-900",children:l}),e[25]=l,e[26]=f):f=e[26];let b;e[27]!==i.maxPoints||e[28]!==f?(b=t.jsxs("div",{className:"text-sm text-gray-500",children:["Score: ",f," / ",i.maxPoints]}),e[27]=i.maxPoints,e[28]=f,e[29]=b):b=e[29];let N;e[30]!==c||e[31]!==p||e[32]!==b?(N=t.jsxs("div",{className:c,children:[p,b]}),e[30]=c,e[31]=p,e[32]=b,e[33]=N):N=e[33];let h;e[34]!==N||e[35]!==d?(h=t.jsx("div",{className:d,children:N}),e[34]=N,e[35]=d,e[36]=h):h=e[36];let w;return e[37]!==h||e[38]!==x||e[39]!==s||e[40]!==n||e[41]!==u?(w=t.jsxs("div",{className:x,children:[s,n,u,h]}),e[37]=h,e[38]=x,e[39]=s,e[40]=n,e[41]=u,e[42]=w):w=e[42],w};function Ke({assessment:m,attempt:e}){const[r,a]=M.useState(e.answers||[]),o=M.useMemo(()=>r.reduce((s,n)=>(s[n.question_id]=s[n.question_id]||[],s[n.question_id].push(n),s),{}),[r]),i=(s,n)=>{a(u=>u.map(f=>f.question_id===s?{...f,manual_score:n}:f))},l=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",c=async()=>{const s=r.map(n=>({question_id:n.question_id,manual_score:n.manual_score??0}));try{await fetch(Y("instructor.classes.subjects.assessments.students.store",{class:1,subject:1,assessment:m.id,student:e.student_id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":l||""},body:JSON.stringify({scores:s})}),q.success("Scores submitted successfully!")}catch(n){console.error(n),q.error("Failed to submit scores.")}},p=m.questions.reduce((s,n)=>s+parseFloat(n.point||0),0),d=m.questions.reduce((s,n)=>{const u=o[n.id]||[],f=u[0]?.manual_score;return s+(f??O(n,u).earnedPoints)},0),x=[{title:"Dashboard",href:"/dashboard"},{title:"Assessments",href:"/assessments"},{title:m.title,href:"#"}];return t.jsxs(I,{breadcrumbs:x,children:[t.jsx(Q,{title:`Results: ${m.title}`}),t.jsxs("div",{className:"mx-auto mt-6 max-w-5xl space-y-8 pb-12",children:[t.jsx(P,{className:"rounded-2xl border bg-white p-6 shadow-sm",children:t.jsxs(F,{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-extrabold text-gray-900",children:m.title}),t.jsx("p",{className:"mt-2 max-w-2xl text-gray-500",children:m.description}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-4",children:[t.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[t.jsx("span",{className:"mr-2 font-medium",children:"Status:"}),t.jsx(B,{className:"uppercase",children:e.status})]}),t.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[t.jsx("span",{className:"mr-2 font-medium",children:"Submitted:"}),t.jsx("span",{children:e.updated_at?R(e.updated_at).format("MMM D, YYYY h:mm A"):"N/A"})]})]})]}),t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"sticky bottom-6 z-50 flex min-w-[140px] flex-col items-center rounded-xl border bg-gray-50 p-4 shadow-lg",children:[t.jsx("span",{className:"mb-1 text-xs font-semibold tracking-wider text-gray-500 uppercase",children:"Total Score"}),t.jsxs("div",{className:"text-4xl font-black text-gray-900",children:[d.toFixed(0),t.jsxs("span",{className:"text-lg font-medium text-gray-400",children:["/",p.toFixed(0)]})]}),t.jsxs("div",{className:"mt-1 text-xs font-medium text-green-600",children:[(d/p*100).toFixed(1),"%"]})]})})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"px-2 text-xl font-bold text-gray-900",children:"Detailed Breakdown"}),m.questions.map((s,n)=>t.jsxs(P,{className:"transition-shadow hover:shadow-md",children:[t.jsxs(H,{className:"flex items-center justify-between py-3",children:[t.jsxs("div",{className:"font-bold text-gray-500",children:["Question ",n+1]}),t.jsx("div",{className:"rounded border bg-white px-2 py-1 font-mono text-xs text-gray-400",children:s.type.replace("_"," ").toUpperCase()})]}),t.jsx(F,{children:t.jsx(G,{question:s,answers:o[s.id]||[],onTeacherScore:i})}),t.jsx(z,{className:"flex justify-end"})]},s.id)),t.jsx("div",{className:"flex justify-end",children:t.jsx(D,{onClick:c,children:"Submit Scores"})})]})]})]})}function V(m){return m.option_text}function Z(m,e){return t.jsx("li",{children:m},e)}export{Ke as default};
