import{d as te,r,u as re,j as e}from"./app-DOexATz8.js";import{Q as ae}from"./QuestionRenderer-CXH3MBWS.js";import{B as Q}from"./badge-CPBjG4_l.js";import{B as a}from"./button-BRVN6i6H.js";import{d as A,c as F,D as B,b as P,a as ie,e as W}from"./dialog-TFrJjmZh.js";import{P as le}from"./progress-AFqel70o.js";import{c as x}from"./utils-CFcDjcb_.js";import{s as ne}from"./index-ikzcNs2d.js";import{C as k}from"./circle-check-big-DiLSee33.js";import{L as oe}from"./layout-dashboard-BMA56064.js";import{W as de,C as ce}from"./wifi-DfXb4Ut0.js";import{W as me}from"./wifi-off-CqIZmAnl.js";import{C as xe}from"./clock-JNa168ul.js";import{L as he}from"./layout-list-C1WqZiYl.js";import{S as pe}from"./square-stack-BqO5DvU-.js";import{L as ue}from"./list-ordered-Dma-l0eK.js";import{I as fe}from"./info-CrSviemM.js";import{C as ge}from"./chevron-left-BwAIY23A.js";import{C as Y}from"./chevron-right-CqdRtJ2F.js";import{S as be}from"./search-BJrQLS36.js";import{T as je}from"./type-Ce9inCyE.js";import{M as we}from"./minimize-2-guiy1pP9.js";import{M as Ne}from"./maximize-2-O5BVre8P.js";import{S as ve}from"./save-U6aSdv-D.js";import{T as ke}from"./triangle-alert-P1pcZk7Y.js";import"./app-Dkd-uU77.js";import"./hard-drive-C7ThFyw9.js";import"./createLucideIcon-j6D0D3Y_.js";import"./image-CZbZ8_rj.js";import"./loader-circle-xDQqgRtj.js";import"./upload-C5XbYVl2.js";import"./file-iwSUTVYm.js";import"./circle-check-BbXVY_J9.js";import"./x-xRkXIo8D.js";import"./textarea-BsNou_JT.js";import"./label-B8z-0cNd.js";import"./index-CsaJF3T3.js";import"./index-Dghi0PCu.js";import"./circle-alert-_35u1DpG.js";import"./command-BJUssI3G.js";import"./index-BiXTY-N1.js";import"./index-DM2N5xoF.js";import"./popover-C4Np6-RM.js";import"./index-BZcpqnGn.js";import"./index-BEPutMgU.js";import"./index-CbEB6B2s.js";import"./index-DI0Uf7dS.js";import"./index-CPEYA-OZ.js";import"./index-D8NCBvGj.js";import"./arrow-right-Cr5VBfnV.js";import"./chevron-up-_obE1ikU.js";import"./grip-horizontal-BNCbtw4K.js";import"./circle-help-a1QgAAb2.js";import"./index-Z9JsAk8n.js";import"./index-D2V0qVjz.js";import"./index-BF4E9qjg.js";import"./circle-BdnuV9lG.js";import"./index-DTzCHv86.js";import"./index-C5FbGKEL.js";import"./with-selector-CQBRQGj8.js";import"./index-BCjrxXRD.js";import"./select-CH_F3wFZ.js";import"./index-C8DTQ8L6.js";import"./check-B5V9zjb2.js";import"./list-CH_oBRHj.js";import"./circle-x-Bx2T49Oq.js";import"./index-DQ5CcXw7.js";import"./index-CHXMgrNC.js";const Se=o=>{const i=Math.floor(o/3600),f=Math.floor(o%3600/60),g=o%60;return[i,f,g].map(N=>N.toString().padStart(2,"0")).join(":")};function Ps({assessment:o,questions:i,student_assessment_attempt_id:f,studentAssessmentAttempt:g}){const{props:N}=te(),S=o.subjects[0],d=g.status!=="draft",b=`exam_draft_${f}`,[l,y]=r.useState({}),[C,V]=r.useState(!0),[ye,z]=r.useState(!1),[h,$]=r.useState(!1),[H,J]=r.useState(16),[M,K]=r.useState(!1),[L,G]=r.useState(null),[c,I]=r.useState("scroll"),[m,v]=r.useState(0),[U,p]=r.useState(!1),[X,j]=r.useState(!1),R=r.useRef({}),T=re({answers:{},user_id:N?.auth?.user?.id});r.useEffect(()=>{const s=()=>V(navigator.onLine);window.addEventListener("online",s),window.addEventListener("offline",s);const t=localStorage.getItem(b);if(t)try{y(JSON.parse(t))}catch(w){console.error("Sync error",w)}const n=w=>{d||(w.preventDefault(),w.returnValue="")};return window.addEventListener("beforeunload",n),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",s),window.removeEventListener("beforeunload",n)}},[b,d]);const Z=()=>{if(d||!o.duration)return 0;const s=new Date(g.started_at).getTime(),t=o.duration*60;return Math.max(0,t-Math.floor((Date.now()-s)/1e3))},[D,_]=r.useState(Z());r.useEffect(()=>{if(d)return;const s=setInterval(()=>{_(t=>t<=1?(clearInterval(s),E(),0):t-1)},1e3);return()=>clearInterval(s)},[d]);const q=(s,t)=>{if(d)return;z(!0);const n={...l,[s]:t};y(n),localStorage.setItem(b,JSON.stringify(n)),setTimeout(()=>z(!1),500)},E=()=>{T.transform(s=>({...s,answers:l})),T.post(ne("student.classes.subjects.assessments.attempt.store",{class_id:S.class_id,subject_id:S.id,assessment_id:o.id,student_assessment_attempt_id:f}),{onSuccess:()=>localStorage.removeItem(b)})},O=(s,t)=>{c==="single"?v(t):R.current[s]?.scrollIntoView({behavior:"smooth",block:"center"}),G(s)},ee=()=>{m<i.data.length-1&&(v(s=>s+1),window.scrollTo({top:0,behavior:"smooth"}))},se=()=>{m>0&&(v(s=>s-1),window.scrollTo({top:0,behavior:"smooth"}))},u=r.useMemo(()=>{const s=i.data.length,t=Object.keys(l).filter(n=>l[n]!==null&&l[n]!=="").length;return{total:s,answered:t,progress:t/s*100,remaining:s-t}},[l,i.data]);return d?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-slate-50 p-6",children:e.jsxs("div",{className:"w-full max-w-md rounded-[3rem] border bg-white p-12 text-center shadow-2xl",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-24 w-24 items-center justify-center rounded-full bg-green-100",children:e.jsx(k,{className:"h-12 w-12 text-green-600"})}),e.jsx("h1",{className:"text-3xl font-black text-slate-900",children:"Submitted!"}),e.jsx("p",{className:"mt-4 font-medium text-slate-500",children:"Your assessment has been recorded."}),e.jsxs(a,{className:"mt-8 w-full rounded-2xl py-7 text-lg",children:[e.jsx(oe,{className:"mr-2 h-5 w-5"})," Return to Dashboard"]})]})}):e.jsxs("div",{className:x("min-h-screen transition-all duration-500",M?"bg-zinc-950 text-white":"bg-slate-50/50 text-slate-900"),style:{fontSize:`${H}px`},children:[e.jsx("header",{className:"sticky top-0 z-50 w-full border-b bg-white/90 shadow-sm backdrop-blur-xl dark:bg-zinc-900/90",children:e.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between px-4 py-3",children:[e.jsx("div",{className:"flex items-center gap-6",children:e.jsxs("div",{className:"hidden md:block",children:[e.jsx("span",{className:"text-[10px] font-black tracking-widest text-slate-400 uppercase",children:"Progress"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{value:u.progress,className:"h-2.5 w-32 md:w-48"}),e.jsxs("span",{className:"text-sm font-bold",children:[u.answered,"/",u.total]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl bg-slate-100 px-4 py-2 dark:bg-zinc-800",children:[C?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden text-[10px] font-black uppercase md:inline",children:"Online"})]}):e.jsxs("div",{className:"flex animate-pulse items-center gap-2 text-red-500",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"text-[10px] font-black uppercase",children:"Offline"})]}),e.jsx("div",{className:"h-4 w-px bg-slate-300 dark:bg-zinc-700"}),e.jsxs("div",{className:x("flex items-center gap-2 font-mono font-bold",D<300?"animate-pulse text-red-500":"text-slate-700 dark:text-zinc-300"),children:[e.jsx(xe,{className:"h-4 w-4"})," ",Se(D)]})]}),e.jsx(a,{onClick:()=>p(!0),disabled:!C,className:"rounded-xl px-6 font-bold shadow-lg shadow-primary/20",children:"Finish"})]})}),e.jsxs("div",{className:"mx-auto flex max-w-7xl gap-8 px-4 py-8",children:[!h&&e.jsxs("aside",{className:"sticky top-24 hidden h-fit w-72 lg:block",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex gap-1 rounded-2xl bg-slate-200 p-1.5 dark:bg-zinc-800",children:[e.jsxs(a,{variant:c==="scroll"?"default":"ghost",size:"sm",onClick:()=>I("scroll"),className:"rounded-xl font-bold",children:[e.jsx(he,{className:"mr-2 h-4 w-4"})," ","Scrolling"]}),e.jsxs(a,{variant:c==="single"?"default":"ghost",size:"sm",onClick:()=>I("single"),className:"rounded-xl font-bold",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"})," ","1-by-1"]})]})}),e.jsxs("div",{className:"rounded-[2rem] border border-slate-200 bg-white p-6 shadow-sm dark:border-zinc-800 dark:bg-zinc-900",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-xs font-black tracking-widest text-slate-400 uppercase",children:[e.jsx(ue,{className:"h-4 w-4"})," Navigation"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:i.data.map((s,t)=>e.jsx("button",{onClick:()=>O(s.id,t),className:x("flex h-12 items-center justify-center rounded-xl border text-sm font-bold transition-all",(c==="single"?m===t:L===s.id)?"scale-110 border-primary bg-primary text-white shadow-lg shadow-primary/30":l[s.id]?"border-green-100 bg-green-50 text-green-600 dark:border-green-800 dark:bg-green-900/20":"border-slate-100 bg-white text-slate-400 dark:border-zinc-700 dark:bg-zinc-800"),children:t+1},s.id))})]})]}),e.jsxs("main",{className:x("flex-1 space-y-10 pb-32 transition-all duration-700",h?"mx-auto max-w-3xl":""),children:[e.jsxs("div",{className:"rounded-[2.5rem] border border-slate-100 bg-white p-10 shadow-sm dark:border-zinc-800 dark:bg-zinc-900",children:[e.jsx("h1",{className:"text-4xl font-black tracking-tight",children:o.title}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:e.jsxs(Q,{variant:"secondary",className:"rounded-lg px-3 py-1 font-bold",children:[e.jsx(fe,{className:"mr-1.5 h-3.5 w-3.5"})," ",i.data.length," Questions"]})})]}),e.jsx("div",{className:"space-y-12",children:i.data.map((s,t)=>c==="single"&&t!==m?null:e.jsxs("section",{ref:n=>R.current[s.id]=n,className:x("relative rounded-[3rem] border p-10 transition-all duration-500",L===s.id||c==="single"?"border-primary bg-white shadow-2xl ring-8 ring-primary/5 dark:bg-zinc-900":"border-slate-200 bg-white/60 dark:border-zinc-800 dark:bg-zinc-900/50"),children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs(Q,{className:"rounded-full bg-slate-900 px-5 py-1.5 text-xs font-black uppercase shadow-lg",children:["Question ",t+1]}),l[s.id]&&e.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-green-50 px-3 py-1 text-[10px] font-black text-green-600 uppercase dark:bg-green-900/30",children:[e.jsx(k,{className:"h-3 w-3"})," ","Recorded"]})]}),e.jsx(ae,{question:s,index:t,answer:l[s.id],onAnswerChange:q,disabled:d}),c==="single"&&e.jsxs("div",{className:"mt-12 flex items-center justify-between border-t border-slate-100 pt-8 dark:border-zinc-800",children:[e.jsxs(a,{variant:"outline",onClick:se,disabled:m===0,className:"h-14 rounded-2xl px-6 font-bold",children:[e.jsx(ge,{className:"mr-2 h-5 w-5"})," ","Previous"]}),e.jsxs("div",{className:"text-sm font-black text-slate-300",children:[m+1," /"," ",i.data.length]}),m===i.data.length-1?e.jsx(a,{onClick:()=>p(!0),className:"h-14 rounded-2xl bg-green-600 px-8 font-bold hover:bg-green-700",children:"Review & Submit"}):e.jsxs(a,{onClick:ee,className:"h-14 rounded-2xl px-8 font-bold",children:["Next"," ",e.jsx(Y,{className:"ml-2 h-5 w-5"})]})]})]},s.id))}),c==="scroll"&&e.jsxs("div",{className:"rounded-[3rem] border-4 border-dashed border-slate-200 p-16 text-center dark:border-zinc-800",children:[e.jsx("h2",{className:"text-3xl font-black text-slate-800 dark:text-zinc-200",children:"All set?"}),e.jsxs("div",{className:"mt-10 flex flex-col items-center justify-center gap-4 sm:flex-row",children:[e.jsxs(a,{variant:"outline",size:"lg",onClick:()=>j(!0),className:"h-16 rounded-2xl border-2 px-8 text-lg font-bold",children:[e.jsx(be,{className:"mr-2 h-5 w-5"})," Review Summary"]}),e.jsxs(a,{size:"lg",onClick:()=>p(!0),className:"h-16 rounded-2xl px-12 text-lg font-black shadow-xl",children:["Final Submit"," ",e.jsx(Y,{className:"ml-2 h-6 w-6"})]})]})]})]})]}),e.jsx("div",{className:"fixed right-8 bottom-8 z-50 flex flex-col gap-3",children:e.jsxs("div",{className:"flex flex-col gap-2 rounded-3xl border border-slate-200 bg-white/80 p-2 shadow-2xl backdrop-blur-xl dark:border-zinc-700 dark:bg-zinc-800/80",children:[e.jsx(a,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-2xl",onClick:()=>J(s=>Math.min(s+2,24)),children:e.jsx(je,{className:"h-5 w-5"})}),e.jsx(a,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-2xl",onClick:()=>K(!M),children:e.jsx(ce,{className:"h-5 w-5"})}),e.jsx(a,{variant:"ghost",size:"icon",className:x("h-12 w-12 rounded-2xl",h&&"bg-primary text-white"),onClick:()=>$(!h),children:h?e.jsx(we,{className:"h-5 w-5"}):e.jsx(Ne,{className:"h-5 w-5"})})]})}),e.jsx(A,{open:U,onOpenChange:p,children:e.jsxs(F,{className:"rounded-[2.5rem] p-10",children:[e.jsxs(B,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-primary/10",children:e.jsx(ve,{className:"h-10 w-10 text-primary"})}),e.jsx(P,{className:"text-3xl font-black",children:"Ready to finish?"}),e.jsx(ie,{className:"pt-2 text-lg",children:u.remaining>0?`Careful! You still have ${u.remaining} unanswered questions.`:"You've answered everything. Ready to submit?"})]}),e.jsxs(W,{className:"mt-8 gap-3 sm:justify-center",children:[e.jsx(a,{variant:"outline",className:"h-14 rounded-xl px-8 font-bold",onClick:()=>p(!1),children:"Keep Working"}),e.jsx(a,{className:"h-14 rounded-xl px-8 font-bold",onClick:E,children:"Yes, Submit Now"})]})]})}),e.jsx(A,{open:X,onOpenChange:j,children:e.jsxs(F,{className:"max-w-2xl rounded-[2.5rem] p-10",children:[e.jsx(B,{children:e.jsx(P,{className:"text-2xl font-black",children:"Review Summary"})}),e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4",children:i.data.map((s,t)=>e.jsxs("button",{onClick:()=>{j(!1),O(s.id,t)},className:x("flex flex-col items-center gap-1 rounded-2xl border-2 p-4 transition-all",l[s.id]?"border-green-500 bg-green-50/50":"border-red-200 bg-red-50/50"),children:[e.jsxs("span",{className:"text-xs font-black text-slate-400 uppercase",children:["Q.",t+1]}),l[s.id]?e.jsx(k,{className:"h-5 w-5 text-green-600"}):e.jsx(ke,{className:"h-5 w-5 text-red-500"})]},s.id))}),e.jsx(W,{className:"mt-8",children:e.jsx(a,{className:"h-14 w-full rounded-xl font-bold",onClick:()=>j(!1),children:"Return to Test"})})]})})]})}export{Ps as default};
