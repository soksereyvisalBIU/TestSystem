import{a as x,j as e,H as _}from"./app-C4-wZLjv.js";import{A}from"./app-layout-CNHzTDPv.js";import{d as q}from"./dayjs.min-6cGuIIDv.js";import{z as v}from"./index-pPUi9S1_.js";import{B as p}from"./badge-z4nG_oU1.js";import{B as h}from"./button-BtXHUDlw.js";import{b as P,d as z,C as E,c as G}from"./card-BPWCgs6A.js";import{P as F}from"./progress-C6pzaZOO.js";import{S as L}from"./separator-Cw301mEt.js";import{QuestionRenderer as B}from"./QuestionRenderer-m80HeChg.js";import{calculateAutoScore as k}from"./calculateAutoScore-DDBuE_7w.js";import{c as g}from"./utils-CFcDjcb_.js";import{C as H}from"./chevron-left-GqJGVrbW.js";import{c as T}from"./createLucideIcon-DDKIJ2e3.js";import{L as Q}from"./loader-circle-BrRjTlNn.js";import{S as I}from"./save-YS-boTpX.js";import"./app-Ctpas7OY.js";import"./index-CmRgzCPv.js";import"./index-Buz4j_7Y.js";import"./index-CHXMgrNC.js";import"./dialog-C5dD38AA.js";import"./index-DeD9CSgl.js";import"./index-CNKjpVcS.js";import"./index-Xko6ReMJ.js";import"./index-C3tRsT71.js";import"./index-Bhes_7Zs.js";import"./index-cZrIM-8D.js";import"./index-ChzAp34M.js";import"./x-cYyiHa3X.js";import"./tooltip-i2vZDwaq.js";import"./index-BthvL4JC.js";import"./index-CeYVXcUJ.js";import"./index-Clov3BKf.js";import"./index-BmIIwECa.js";import"./index-DRemKmJw.js";import"./avatar-DWKof1ni.js";import"./index-C2fpaiMf.js";import"./index-BZB35nAZ.js";import"./index-CMWG4mbA.js";import"./command-HKHPfprr.js";import"./search-Cxo_qDnu.js";import"./index-ikzcNs2d.js";import"./app-logo-icon-BJ5tEmQI.js";import"./layout-grid-CEBlWw-x.js";import"./users-CUYIQcdw.js";import"./settings-2-DUZge6eM.js";import"./cpu-DrMaJJL5.js";import"./book-open-DhnomZaK.js";import"./chevron-right-CZckLAVz.js";import"./appearance-tabs-header-DkuhK1KQ.js";import"./sun-DVv0vIb6.js";import"./ChoiceQuestion-otBcNUvC.js";import"./sparkles-Dy7xQZPs.js";import"./check-Fwforxvc.js";import"./circle-check-CE5iqhEP.js";import"./FileQuestion-HAoDr5gl.js";import"./file-text-BlmxyJcG.js";import"./maximize-2-LnnShh8S.js";import"./file-Br47PucB.js";import"./clock-CiUKO93g.js";import"./eye-CExwr-rA.js";import"./download-BeIOZcTV.js";import"./copy-O9zlw-jg.js";import"./MatchingQuestion-0FzdQvC9.js";import"./arrow-right-CCFdR1G3.js";import"./TextQuestion-CnEwBwa-.js";import"./label-BeNpEvcw.js";import"./code-xml-BupXVzCv.js";import"./circle-alert-BQkIx_3U.js";import"./file-up-PYrBm7lJ.js";import"./pen-line-DET6Oo_E.js";import"./circle-help-DD5Ejhof.js";import"./circle-x-C35IsA1L.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],$=T("History",R);function ds({assessment:r,attempt:c}){const[u,y]=x.useState(c.answers||[]),[f,b]=x.useState(!1),n=x.useMemo(()=>u.reduce((s,t)=>(s[t.question_id]=s[t.question_id]||[],s[t.question_id].push(t),s),{}),[u]),M=(s,t)=>{y(i=>i.map(l=>l.question_id===s?{...l,manual_score:t}:l))},a=x.useMemo(()=>{let s=0,t=0,i=0;const l=r.questions.map(m=>{const o=n[m.id],d=o?.[0]?.manual_score,C=k(m,o),N=parseFloat(m.point||0);let w=d!=null&&d!==""?parseFloat(d):o?.[0]?.point_earned??C.earnedPoints;return s+=w,t+=N,(o?.[0]?.manual_score!=null||o?.[0]?.point_earned!=null)&&i++,{id:m.id,earned:w,max:N,isManual:d!=null}});return{totalEarned:s,totalMax:t,gradedCount:i,details:l}},[r.questions,n]),j=a.totalMax>0?(a.totalEarned/a.totalMax*100).toFixed(1):0,S=async()=>{b(!0),r.questions.map(s=>{const t=n[s.id],i=t[0]?.manual_score,l=i!=null&&i!==""?parseFloat(i):t[0]?.point_earned??k(s,t).earnedPoints;return{question_id:s.id,score:l}});try{await new Promise(s=>setTimeout(s,1e3)),v.success("Grades synchronized successfully")}catch{v.error("Connection error. Please try again.")}finally{b(!1)}};return e.jsxs(A,{breadcrumbs:[{title:"Assessments",href:"/assessments"},{title:"Grading"}],children:[e.jsx(_,{title:`Grading: ${c.student?.name}`}),e.jsxs("div",{className:"min-h-screen bg-[#f8fafc] pb-40",children:[e.jsx("div",{className:"sticky top-0 z-40 w-full border-b bg-white/80 backdrop-blur-md",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 py-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-full",onClick:()=>window.history.back(),children:e.jsx(H,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-black tracking-tight text-slate-900",children:c.student?.name}),e.jsxs("p",{className:"text-xs font-bold tracking-widest text-slate-400 uppercase",children:[r.title," â€¢"," ",q(c.updated_at).format("MMM D")]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"hidden text-right md:block",children:[e.jsx("p",{className:"text-[10px] font-black tracking-tighter text-slate-400 uppercase",children:"Completion"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-bold",children:[a.gradedCount,"/",r.questions.length]}),e.jsx(F,{value:a.gradedCount/r.questions.length*100,className:"h-1.5 w-20"})]})]}),e.jsxs("div",{className:"flex h-12 items-center gap-4 rounded-2xl bg-slate-900 px-6 py-2 text-white shadow-2xl shadow-slate-200",children:[e.jsxs("div",{className:"border-r border-slate-700 pr-4",children:[e.jsx("span",{className:"mb-1 block text-[10px] leading-none font-bold text-slate-500 uppercase",children:"Grade"}),e.jsxs("span",{className:"text-xl font-black",children:[a.totalEarned,e.jsxs("span",{className:"ml-1 text-sm text-slate-500",children:["/",a.totalMax]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-lg font-black text-emerald-400",children:[j,"%"]})})]})]})]})})}),e.jsx("div",{className:"mx-auto mt-8 max-w-7xl px-4 sm:px-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-12",children:[e.jsx("aside",{className:"sticky top-24  hidden lg:col-span-3 lg:block",children:e.jsxs("div",{className:"sticky top-28 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-black tracking-widest text-slate-400 uppercase",children:"Question Map"}),e.jsxs(p,{variant:"outline",className:"text-[10px]",children:[r.questions.length," Total"]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:a.details.map((s,t)=>e.jsxs("a",{href:`#q-${s.id}`,className:g("group flex items-center justify-between rounded-xl px-3 py-2.5 transition-all hover:scale-[1.02]",s.isManual?"bg-indigo-50 ring-1 ring-indigo-200 ring-inset":"bg-slate-50 hover:bg-white hover:shadow-md"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:g("text-[10px] font-black",s.isManual?"text-indigo-600":"text-slate-400"),children:t+1}),e.jsx("span",{className:"text-xs font-bold text-slate-700",children:"Question"})]}),e.jsxs("span",{className:g("text-xs font-black",s.earned===s.max?"text-emerald-600":s.earned>0?"text-amber-600":"text-slate-400"),children:[s.earned,"/",s.max]})]},s.id))})]}),e.jsxs("div",{className:"rounded-2xl bg-indigo-600 p-5 text-white shadow-xl shadow-indigo-200",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-indigo-200",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"text-[10px] font-bold tracking-widest uppercase",children:"Grading Note"})]}),e.jsxs("p",{className:"text-xs leading-relaxed opacity-90",children:["Auto-grading handles objective questions. Manual overrides are highlighted in"," ",e.jsx("span",{className:"font-bold underline",children:"blue"}),"."]})]})]})}),e.jsx("main",{className:"space-y-10 lg:col-span-9",children:r.questions.map((s,t)=>e.jsx("section",{id:`q-${s.id}`,className:"scroll-mt-28",children:e.jsxs(P,{className:"overflow-hidden border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] ring-1 ring-slate-200 transition-all focus-within:ring-2 focus-within:ring-indigo-500",children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 border-b border-slate-50 bg-white px-8 py-5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-slate-900 text-sm font-black text-white shadow-lg",children:t+1}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-black tracking-tight text-slate-800 uppercase",children:s.type.replace("_"," ")}),e.jsxs("p",{className:"text-[10px] font-bold tracking-tighter text-slate-400 uppercase",children:["Section Point:"," ",s.point]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n[s.id]?.[0]?.manual_score!=null&&e.jsx(p,{className:"border-none bg-indigo-100 text-indigo-700 hover:bg-indigo-100",children:"Modified"}),e.jsxs(p,{variant:"outline",className:"border-slate-200 text-[10px] font-black text-slate-400 uppercase",children:["Reference #",s.id]})]})]}),e.jsx(G,{className:"p-8",children:e.jsx(B,{question:s,answers:n[s.id]||[],onTeacherScore:M})})]})},s.id))})]})}),e.jsx("div",{className:"fixed bottom-8 left-1/2 z-50 w-full max-w-3xl -translate-x-1/2 px-4",children:e.jsxs("div",{className:"flex items-center justify-between rounded-3xl border border-white/20 bg-slate-900/90 p-3 shadow-[0_20px_50px_rgba(0,0,0,0.3)] backdrop-blur-xl",children:[e.jsxs("div",{className:"flex items-center gap-6 pl-6 text-white",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black tracking-tighter text-slate-500 uppercase",children:"Session Grade"}),e.jsxs("p",{className:"text-lg leading-none font-black",children:[a.totalEarned," ",e.jsxs("span",{className:"text-xs text-slate-500",children:["/ ",a.totalMax]})]})]}),e.jsx(L,{orientation:"vertical",className:"h-10 bg-slate-700"}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("p",{className:"text-[10px] font-black tracking-tighter text-slate-500 uppercase",children:"Final Percent"}),e.jsxs("p",{className:"text-lg leading-none font-black text-emerald-400",children:[j,"%"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"ghost",className:"rounded-2xl font-bold text-slate-400 hover:bg-slate-800 hover:text-white",onClick:()=>window.history.back(),children:"Discard"}),e.jsxs(h,{onClick:S,disabled:f,className:"rounded-2xl bg-indigo-500 px-10 font-black shadow-xl shadow-indigo-500/20 transition-all hover:bg-indigo-400 active:scale-95",children:[f?e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(I,{className:"mr-2 h-4 w-4"}),"Finalize All Grades"]})]})]})})]})]})}export{ds as default};
