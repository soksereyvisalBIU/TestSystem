import{a as m,j as e,H as q,L as B,f as E,c as z}from"./app-CtGYIsX5.js";import{A as G}from"./app-layout-BBM8JRvq.js";import{z as Q}from"./index-ClDXPIEY.js";import{s as y}from"./index-ikzcNs2d.js";import{B as M}from"./badge-DqD2fi5U.js";import{B as j}from"./button-SSRY5RuB.js";import{C as L}from"./card-CSebWWaB.js";import{P as H}from"./progress-DFTUlJHU.js";import{S as V}from"./separator-CX4y_G-K.js";import{c as D,b as O,a as U,T as J}from"./tooltip-Kptx307E.js";import{QuestionRenderer as R}from"./QuestionRenderer-BWye7OV8.js";import{calculateAutoScore as F}from"./calculateAutoScore-DDBuE_7w.js";import{C as I}from"./circle-check-CCR-bfyz.js";import{A as K}from"./arrow-left-CnbDjp5Q.js";import{A as W}from"./arrow-right-DEhewvfN.js";import{C as $}from"./chevron-left-pIaqhvJj.js";import{L as X}from"./layout-list-Brq4i9_w.js";import{E as Y}from"./eye-Cvrt8dpm.js";import{F as Z}from"./filter-BrR6L--0.js";import{C as ee}from"./circle-alert-vcwaaZPs.js";import{L as se}from"./loader-circle-BsNW6eBu.js";import{S as re}from"./save-H6X48jVO.js";/* empty css            */import"./index-BKaEAUkC.js";import"./index-CEEHIV-V.js";import"./index-CHXMgrNC.js";import"./utils-CFcDjcb_.js";import"./dialog-CIu6aBNx.js";import"./index-DBcQu2g4.js";import"./index-CXdRv3aZ.js";import"./index-BVpJEfSU.js";import"./index-CNX5aJ-H.js";import"./index-C59Bp4nL.js";import"./index-DwRVN30-.js";import"./index-CRv2uW8x.js";import"./x-DU5AeFAo.js";import"./createLucideIcon-CxmHDfoc.js";import"./index-C8PlrU9g.js";import"./index-C9d5FcxV.js";import"./index-84d56XFz.js";import"./index-aq0HBlNE.js";import"./avatar-DxZQoBSB.js";import"./index-D82MWXkw.js";import"./index-BZB35nAZ.js";import"./index-CMWG4mbA.js";import"./command-UaJet_Jc.js";import"./search-DRKxlw3r.js";import"./app-logo-icon-Bxpw9t1P.js";import"./layout-grid-DEAqSi1K.js";import"./users-DBrrkKjv.js";import"./settings-2-CRDbYWN2.js";import"./appearance-tabs-header-BY9j7uhR.js";import"./sun-CTkdtCHx.js";import"./book-open-B5VUcvi6.js";import"./chevron-right-D9BgXrdj.js";import"./index-G2kbjg3X.js";import"./ChoiceQuestion-uZRizHxL.js";import"./sparkles-Z9I5gX6h.js";import"./check-DIlxvegC.js";import"./FileQuestion-Dymvyjqg.js";import"./file-text-DgeumOOP.js";import"./maximize-2-QK4LStZ-.js";import"./file-DQI_nw8F.js";import"./clock-DLMNneh3.js";import"./download-D2DNlKLQ.js";import"./external-link-Bslax01s.js";import"./copy-bf6eAge9.js";import"./MatchingQuestion-l_m-J9RL.js";import"./TextQuestion-Co4NQd5e.js";import"./label-BTRaqjID.js";import"./code-xml-B6wwogQU.js";import"./file-up-BGw35U-r.js";import"./pen-line-DXz5vq0d.js";import"./circle-help-BMB39SxM.js";import"./circle-x-CTdiMIhm.js";function ys({assessment:i,attempt:t}){const[w,v]=m.useState(t?.answers||[]),[f,l]=m.useState(!1),[n,x]=m.useState("list"),[u,S]=m.useState("all"),[g,k]=m.useState(0),c=m.useMemo(()=>{const s=new Map;return w.forEach(r=>{s.has(r.question_id)||s.set(r.question_id,[]),s.get(r.question_id).push(r)}),s},[w]),d=m.useMemo(()=>{let s=i.questions.map((r,o)=>({...r,originalIndex:o}));return u==="needs_review"&&(s=s.filter(r=>{const a=(c.get(r.id)||[])[0]?.manual_score,p=a!=null&&a!=="";return(r.type==="fill_blank"||r.type==="short_answer"||r.type==="fileupload")&&!p})),s},[i.questions,u,c]),h=m.useMemo(()=>{let s=0,r=0,o=0;return i.questions.forEach(a=>{const p=parseFloat(a.point||0);r+=p;const N=c.get(a.id)||[],b=N[0]?.manual_score;if(b!=null&&b!=="")s+=parseFloat(b),o++;else{const T=F(a,N);s+=T.earnedPoints,a.type!=="essay"&&o++}}),{earned:s.toFixed(1),max:r,progress:o/i.questions.length*100,isComplete:o===i.questions.length}},[i.questions,c]),A=m.useCallback((s,r)=>{v(o=>o.map(a=>a.question_id===s?{...a,manual_score:r}:a))},[]),P=()=>{l(!0);const s=i.questions.map(r=>{const o=c.get(r.id)||[],a=o[0]?.manual_score,p=a!=null&&a!==""?parseFloat(a):F(r,o).earnedPoints;return{question_id:r.id,score:p}});E.post(y("instructor.classes.subjects.assessments.students.store",{class:1,subject:1,assessment:i.id,student:t.student_id}),{student_assessment_attempt_id:t?.id,answers:s},{onSuccess:()=>Q.success("Grades updated"),onFinish:()=>l(!1)})};return e.jsxs(G,{children:[e.jsx(q,{title:`Grading: ${t?.student?.name}`}),e.jsxs("div",{className:"relative max-h-[90vh] bg-slate-50/50 dark:bg-background",children:[e.jsx("div",{className:"relative mx-auto mt-8 max-w-7xl px-4 sm:px-6",children:e.jsxs("div",{className:"relative grid grid-cols-1 gap-8 lg:grid-cols-12",children:[e.jsx("div",{className:"pb-36 lg:col-span-8 xl:col-span-9",children:d.length===0?e.jsxs(L,{className:"flex flex-col items-center justify-center border-dashed py-24 text-center",children:[e.jsx("div",{className:"mb-4 rounded-full bg-green-100 p-4 dark:bg-green-900/30",children:e.jsx(I,{className:"h-12 w-12 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-bold text-title",children:"Review Complete"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"No questions matching your current filter."}),e.jsx(j,{variant:"link",onClick:()=>S("all"),children:"Show all questions"})]}):e.jsx("div",{className:"space-y-8",children:n==="list"?d.map(s=>e.jsx("div",{id:`q-${s.id}`,className:"scroll-mt-24",children:e.jsx(R,{question:s,index:s.originalIndex,answers:c.get(s.id)||[],onTeacherScore:A})},s.id)):e.jsxs("div",{className:"animate-in duration-300 fade-in slide-in-from-bottom-4",children:[e.jsx(R,{question:d[g],index:d[g].originalIndex,answers:c.get(d[g].id)||[],onTeacherScore:A}),e.jsxs("div",{className:"mt-8 flex items-center justify-between rounded-2xl border bg-card p-4 shadow-sm",children:[e.jsxs(j,{variant:"outline",disabled:g===0,onClick:()=>k(s=>s-1),children:[e.jsx(K,{className:"mr-2 h-4 w-4"})," ","Previous"]}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:["Question ",g+1," ","of ",d.length]}),e.jsxs(j,{variant:"outline",disabled:g===d.length-1,onClick:()=>k(s=>s+1),children:["Next"," ",e.jsx(W,{className:"ml-2 h-4 w-4"})]})]})]})})}),e.jsx("aside",{className:"relative lg:col-span-4 xl:col-span-3",children:e.jsx("div",{className:"sticky top-0 self-start",children:e.jsxs(L,{className:"gap-0 overflow-hidden border-none py-0 shadow-lg ring-1 ring-slate-200 dark:ring-border",children:[e.jsxs("div",{className:"border-b bg-slate-50 p-4 dark:bg-card",children:[e.jsxs(j,{variant:"ghost",size:"sm",className:"mb-2 -ml-2 h-8 text-muted-foreground hover:text-foreground",onClick:()=>y("instructor.classes.subjects.assessments.students.index",{class:1,subject:1,assessment:i.id}),children:[e.jsx($,{className:"mr-1 h-4 w-4"})," ","Back to Students"]}),e.jsxs(B,{href:y("instructor.classes.subjects.assessments.students.index",{class:1,subject:1,assessment:i.id}),children:[e.jsx($,{className:"mr-1 h-4 w-4"})," ","Back to Students"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-bold text-title",children:"Grading Progress"}),e.jsxs(M,{variant:h.isComplete?"success":"secondary",className:"font-mono",children:[Math.round(h.progress),"%"]})]}),e.jsx(H,{value:h.progress,className:"h-2 bg-slate-200 dark:bg-muted"})]})]}),e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-[10px] font-bold tracking-widest text-muted-foreground uppercase",children:"Display Options"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 rounded-lg bg-slate-100 p-1 dark:bg-muted",children:[e.jsxs("button",{onClick:()=>x("list"),className:`flex items-center justify-center gap-2 rounded-md py-1.5 text-xs font-semibold transition-all ${n==="list"?"bg-white text-primary shadow-sm dark:bg-card":"text-slate-500 hover:text-slate-700 dark:text-muted-foreground dark:hover:text-foreground"}`,children:[e.jsx(X,{className:"h-3.5 w-3.5"})," ","List"]}),e.jsxs("button",{onClick:()=>x("single"),className:`flex items-center justify-center gap-2 rounded-md py-1.5 text-xs font-semibold transition-all ${n==="single"?"bg-white text-primary shadow-sm dark:bg-card":"text-slate-500 hover:text-slate-700 dark:text-muted-foreground dark:hover:text-foreground"}`,children:[e.jsx(Y,{className:"h-3.5 w-3.5"})," ","Focus"]})]}),e.jsxs(j,{variant:u==="needs_review"?"secondary":"outline",size:"sm",className:`w-full justify-start text-xs ${u==="needs_review"?"ring-1 ring-amber-500/20 dark:ring-amber-400/30":""}`,onClick:()=>S(u==="needs_review"?"all":"needs_review"),children:[e.jsx(Z,{className:`mr-2 h-3.5 w-3.5 ${u==="needs_review"?"text-amber-600 dark:text-amber-400":""}`}),u==="needs_review"?"Showing Needs Review":"Filter: Needs Review"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-[10px] font-bold tracking-widest text-muted-foreground uppercase",children:"Question Map"}),e.jsx("div",{className:"grid grid-cols-5 gap-1.5",children:i.questions.map((s,r)=>{const a=(c.get(s.id)||[])[0]?.manual_score!=null,p=s.type==="fill_blank"||s.type==="short_answer"||s.type==="fileupload",N=n==="list"?!1:d[g]?.id===s.id;return e.jsx(D,{children:e.jsxs(O,{children:[e.jsx(U,{asChild:!0,children:e.jsx("button",{onClick:()=>{if(n==="single"){const b=d.findIndex(_=>_.id===s.id);b!==-1&&k(b)}else document.getElementById(`q-${s.id}`)?.scrollIntoView({behavior:"smooth"})},className:`flex aspect-square w-full items-center justify-center rounded-md border text-[11px] font-bold transition-all ${N?"border-primary bg-primary/10 text-primary ring-2 ring-primary ring-offset-1 dark:ring-offset-background":a?"border-primary bg-primary text-primary-foreground":p?"border-amber-200 bg-amber-50 text-amber-700 hover:bg-amber-100 dark:border-amber-800 dark:bg-amber-950 dark:text-amber-400 dark:hover:bg-amber-900":"border-slate-200 bg-white text-slate-400 hover:border-slate-300 dark:border-border dark:bg-card dark:text-muted-foreground dark:hover:border-slate-600"}`,children:r+1})}),e.jsx(J,{side:"top",children:e.jsx("p",{className:"text-xs",children:p?"Requires Manual Grade":"Auto-graded"})})]})},s.id)})})]}),e.jsxs("div",{className:"space-y-2 border-t pt-4 dark:border-border",children:[e.jsx(C,{color:"bg-primary",label:"Manually Graded"}),e.jsx(C,{color:"bg-amber-400 dark:bg-amber-500",label:"Pending Review"}),e.jsx(C,{color:"bg-slate-200 dark:bg-muted",label:"Auto-scored"})]})]})]})})})]})}),e.jsx("div",{className:"fixed bottom-8 left-1/2 z-50 w-full max-w-4xl -translate-x-1/2 px-4",children:e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border bg-background/90 p-4 shadow-2xl backdrop-blur-lg dark:border-border dark:bg-card/90",children:[e.jsxs("div",{className:"flex items-center gap-8 pl-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold tracking-widest text-muted-foreground uppercase",children:"Current Total"}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-black text-primary",children:h.earned}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:["/ ",h.max," pts"]})]})]}),e.jsx(V,{orientation:"vertical",className:"h-10"}),e.jsx("div",{className:"hidden md:block",children:h.isComplete?e.jsxs(M,{className:"bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700",children:[e.jsx(I,{className:"mr-1 h-3 w-3"})," ","Ready to Finalize"]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-amber-600 dark:text-amber-400",children:[e.jsx(ee,{className:"h-4 w-4"})," ","Pending Review"]})})]}),e.jsxs(j,{size:"lg",onClick:P,disabled:f,className:`rounded-xl px-10 font-bold transition-all ${h.isComplete?"bg-primary hover:bg-primary/90":"bg-slate-800 hover:bg-slate-700 dark:bg-slate-700 dark:hover:bg-slate-600"}`,children:[f?e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(re,{className:"mr-2 h-4 w-4"}),"Update Grade"]})]})})]})]})}function C(i){const t=z.c(7),{color:w,label:v}=i,f=`h-2.5 w-2.5 rounded-full ${w}`;let l;t[0]!==f?(l=e.jsx("div",{className:f}),t[0]=f,t[1]=l):l=t[1];let n;t[2]!==v?(n=e.jsx("span",{children:v}),t[2]=v,t[3]=n):n=t[3];let x;return t[4]!==l||t[5]!==n?(x=e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold tracking-tight text-muted-foreground/80 uppercase",children:[l,n]}),t[4]=l,t[5]=n,t[6]=x):x=t[6],x}export{ys as default};
