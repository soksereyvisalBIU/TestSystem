import{k as be,c as z,i as Se,a as f,t as ue,j as b}from"./app-BEjprfpt.js";import Ee from"./QuestionActions-CnEvp-lq.js";import je from"./QuestionFormModal-DNdtE4Ya.js";import $e from"./QuestionList-Bw_Z6VWB.js";import Oe from"./OrderQuestion-B45anLnG.js";import ke from"./ScoreSettings-CPnhdvyP.js";import{a as Me,u as ve}from"./useMutation-CH36C3h9.js";import{n as E}from"./index-BYiI1tkd.js";import{b as Ae}from"./SortableItem-BT96sw-V.js";import"./app-C2HJU6IN.js";import"./button-DGod-GTx.js";import"./index-sZL0LmKN.js";import"./index-joJZZ6T8.js";import"./index-CHXMgrNC.js";import"./utils-CFcDjcb_.js";import"./tooltip-CpjmRnmA.js";import"./index-DsHUgfkw.js";import"./index-CVovHSZ1.js";import"./index-DH1X2cpJ.js";import"./index-rsEto4aw.js";import"./index-DU3jUZ6J.js";import"./index-Db_ipX0A.js";import"./index-Brhvp-qm.js";import"./index-Bnui9FJL.js";import"./index-Da8MCGzP.js";import"./index-COWxmS2u.js";import"./plus-fFbh7Iuh.js";import"./createLucideIcon-SD458vc9.js";import"./save-DPqs5y9_.js";import"./circle-check-D0q-_Uz_.js";import"./modal-BQMMrss4.js";import"./dialog-isigwEAQ.js";import"./x-9rjc8L--.js";import"./input-D01gTe9K.js";import"./label-tp4e9AWt.js";import"./select-B9AeDQUe.js";import"./index-dA-rYMbt.js";import"./index-DjAg5VJJ.js";import"./chevron-up-CElMC7bz.js";import"./check-DNy6Q5Gp.js";import"./FileUploadForm-CrNwySCP.js";import"./textarea-CgG8HGNy.js";import"./file-text-BTi6k94-.js";import"./image-mFkxl4qo.js";import"./images-kx8iC3u6.js";import"./hard-drive-CgBG-Mr3.js";import"./FillBlankForm-CAjkEWe4.js";import"./circle-alert-BPPGSlpv.js";import"./type-lmHtqj6c.js";import"./eye-qNFWh0j6.js";import"./MatchingForm-BdOFtLgU.js";import"./grip-vertical-DedqoblY.js";import"./trash-2-CqevF9IN.js";import"./MultipleChoiceForm-CIF-d5MI.js";import"./circle-DWGOQ8bk.js";import"./OrderingForm-BlB3Gbxz.js";import"./list-ordered-DTA-Wd7A.js";import"./info-BTUJ9Bxo.js";import"./ShortAnswerForm-BiCSgdRy.js";import"./index-BGw31R_0.js";import"./index-CI6TeYZF.js";import"./with-selector-D5OwMqhf.js";import"./code-xml-ATM5qUgc.js";import"./list-D283kaZy.js";import"./sparkles-CUsC-2pB.js";import"./TrueFalseForm-M__X77HB.js";import"./circle-x-CsKtQwFL.js";import"./layers-BFKQ4yKg.js";import"./circle-help-C5KnjDZQ.js";import"./file-BoRE40qY.js";import"./settings-2-BMKDjTqy.js";import"./circle-plus-JoU-MqgV.js";import"./trophy-DdzuDw5_.js";import"./QuestionCard-BYzYtuFf.js";import"./badge-DVoRCxHz.js";import"./renderAnswer-hvWeazPH.js";import"./file-up-C1yOACBt.js";import"./arrow-right-C6kumotC.js";import"./pen-line-DESckUgy.js";import"./star-LyzqUutM.js";import"./calculator-DS-D0BXM.js";import"./layout-list-CDQg4Hy9.js";import"./grip-horizontal-CFTbVEEG.js";import"./card-BaYWL8Gi.js";import"./progress-pIsaJNP-.js";import"./target-BCN7VD7l.js";import"./hash-BlQpriub.js";const me=be.create({baseURL:"/",headers:{"Content-Type":"application/json"}}),De=t=>{const e=z.c(7);let r,o;e[0]!==t?(r=["assessments",t,"questions"],o=async()=>{const{data:l}=await me.get(`api/v1/assessments/${t}/questions`);return console.log(l),l.data},e[0]=t,e[1]=r,e[2]=o):(r=e[1],o=e[2]);const s=!!t;let i;return e[3]!==r||e[4]!==o||e[5]!==s?(i={queryKey:r,queryFn:o,enabled:s,onError:Le},e[3]=r,e[4]=o,e[5]=s,e[6]=i):i=e[6],Me(i)},Ne=t=>{const e=z.c(8),r=Se();let o;e[0]!==t?(o=async l=>{console.log(l);const{data:p}=await me.post(`api/v1/assessments/${t}/questions`,l);return console.log(p),console.log(p.data),p.data},e[0]=t,e[1]=o):o=e[1];let s;e[2]!==t||e[3]!==r?(s=l=>{E.success("Question created successfully!"),console.log(l),r.setQueryData(["assessments",t,"questions"],p=>[l,...p===void 0?[]:p])},e[2]=t,e[3]=r,e[4]=s):s=e[4];let i;return e[5]!==o||e[6]!==s?(i={mutationFn:o,onSuccess:s,onError:Fe},e[5]=o,e[6]=s,e[7]=i):i=e[7],ve(i)},Pe=t=>{const e=z.c(8),r=Se();let o;e[0]!==t?(o=async l=>{const p=Array.isArray(l)?l:[l];try{return await Promise.all(p.map(async c=>{if(!c?.id)throw console.warn("⚠️ Missing question ID — skipping update:",c),new Error('Invalid question: missing "id"');const{data:F}=await me.put(`api/v1/assessments/${t}/questions/${c.id}`,c);return F.data}))}catch(d){const c=d;throw console.error("❌ Error updating questions:",c),c}},e[0]=t,e[1]=o):o=e[1];let s;e[2]!==t||e[3]!==r?(s=l=>{const p=Array.isArray(l)?l:[l];p.forEach(d=>{d?.id&&r.setQueryData(["questions",d.id],d)}),r.invalidateQueries({queryKey:["assessments",t,"questions"]}),console.log("✅ Updated questions:",l),E.success(p.length>1?"Questions updated successfully!":"Question updated successfully!")},e[2]=t,e[3]=r,e[4]=s):s=e[4];let i;return e[5]!==o||e[6]!==s?(i={mutationFn:o,onSuccess:s,onError:Ce},e[5]=o,e[6]=s,e[7]=i):i=e[7],ve(i)},qe=t=>{const e=z.c(8),r=Se();let o;e[0]!==t?(o=async l=>{await me.delete(`api/v1/assessments/${t}/questions/${l}`)},e[0]=t,e[1]=o):o=e[1];let s;e[2]!==t||e[3]!==r?(s=()=>{E.success("Question deleted successfully!"),r.invalidateQueries({queryKey:["assessments",t,"questions"]})},e[2]=t,e[3]=r,e[4]=s):s=e[4];let i;return e[5]!==o||e[6]!==s?(i={mutationFn:o,onSuccess:s,onError:Ie},e[5]=o,e[6]=s,e[7]=i):i=e[7],ve(i)};function Le(t){if(t.response?.status===422){const e=t.response.data.errors,r=Object.values(e).flat().join(`
`);E.error(r)}else E.error("Server error — try again later")}function Fe(t){if(t.response?.status===422){const e=t.response.data.errors,r=Object.values(e).flat().join(`
`);E.error(r)}else if(t){const e=t.response.data,r=Object.values(e).flat().join(`
`);E.error(r)}else E.error("Server error — try again later")}function Ce(t){if(console.error("❌ Update question failed:",t),t.response?.status===422){const e=t.response.data.errors,r=Object.values(e).flat().join(`
`);E.error(r)}else E.error("Server error — try again later")}function Ie(){return E.error("Failed to delete question.")}const pe=t=>`assessment_backup_${t}`,Te=t=>{const e=z.c(67);let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=[],e[0]=r):r=e[0];const[o,s]=f.useState(r);let i;e[1]===Symbol.for("react.memo_cache_sentinel")?(i=[],e[1]=i):i=e[1];const[l,p]=f.useState(i);let d;e[2]===Symbol.for("react.memo_cache_sentinel")?(d=[],e[2]=d):d=e[2];const[c,F]=f.useState(d),[D,G]=f.useState(!1),[S,B]=f.useState(null),[C,H]=f.useState(null),[I,N]=f.useState(!1),[T,J]=f.useState(!1),[h,R]=f.useState(100);let P;e[3]===Symbol.for("react.memo_cache_sentinel")?(P={},e[3]=P):P=e[3];const[g,V]=f.useState(P),[m,q]=f.useState(!1),{data:v,isLoading:j}=De(t);let Q;e[4]!==v?(Q=v===void 0?[]:v,e[4]=v,e[5]=Q):Q=e[5];const y=Q,{mutate:$}=Ne(t),{mutate:O}=Pe(t),{mutate:U}=qe(t);let x,M;e[6]!==t||e[7]!==y?(x=()=>{const a=localStorage.getItem(pe(t));if(a)try{const n=JSON.parse(a);s(n),p(y),ue.info("Restored unsaved changes from backup")}catch(n){console.error("Failed to parse backup",n)}else y?.length>0&&(s(y),p(y));G(!0)},M=[y,t],e[6]=t,e[7]=y,e[8]=x,e[9]=M):(x=e[8],M=e[9]),f.useEffect(x,M);let w,W;e[10]!==t||e[11]!==D||e[12]!==l||e[13]!==o?(w=()=>{if(!D)return;const a=JSON.stringify(o)!==JSON.stringify(l);J(a),a?localStorage.setItem(pe(t),JSON.stringify(o)):localStorage.removeItem(pe(t))},W=[o,l,t,D],e[10]=t,e[11]=D,e[12]=l,e[13]=o,e[14]=w,e[15]=W):(w=e[14],W=e[15]),f.useEffect(w,W);let X,Y;e[16]===Symbol.for("react.memo_cache_sentinel")?(X=()=>{const a=n=>{n.ctrlKey&&(n.key==="q"||n.key==="Q")&&(n.preventDefault(),N(!0))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},Y=[],e[16]=X,e[17]=Y):(X=e[16],Y=e[17]),f.useEffect(X,Y);let Z;e[18]!==o||e[19]!==h||e[20]!==g?(Z=()=>{if(o.length===0)return;const a=o.reduce(Ue,{}),n=o.map(u=>{const k=u.type||"Unknown",L=a[k]??[],K=(g[k]??0)/100*h,we=L.length>0?K/L.length:0;return{...u,point:parseFloat(we.toFixed(2)),updated:!0}});s(n)},e[18]=o,e[19]=h,e[20]=g,e[21]=Z):Z=e[21];const A=Z;let _;e[22]!==m||e[23]!==c||e[24]!==o||e[25]!==A?(_=()=>{m?(F(o.map(Ke)),A()):c.length>0&&s(a=>a.map(n=>{const u=c.find(k=>k.id===(n.id??n.tempId));return u?{...n,point:u.point}:n}))},e[22]=m,e[23]=c,e[24]=o,e[25]=A,e[26]=_):_=e[26];let ee;e[27]!==m?(ee=[m],e[27]=m,e[28]=ee):ee=e[28],f.useEffect(_,ee);let te;e[29]!==m||e[30]!==A?(te=()=>{m&&A()},e[29]=m,e[30]=A,e[31]=te):te=e[31];let oe;e[32]!==h||e[33]!==g?(oe=[h,g],e[32]=h,e[33]=g,e[34]=oe):oe=e[34],f.useEffect(te,oe);let re;e[35]!==S||e[36]!==o?(re=a=>{if(S!==null){const n=[...o];n[S]={...n[S],...a,updated:!0},s(n.map(Be)),B(null)}else s(n=>[...n,{...a,isNew:!0,tempId:Date.now(),order:n.length+1}].map(Je));N(!1)},e[35]=S,e[36]=o,e[37]=re):re=e[37];const fe=re;let se;e[38]!==U||e[39]!==o?(se=a=>{const n=o[a],u=o.filter((k,L)=>L!==a).map(Re);s(u),n.id&&U(n.id),ue.success("Question deleted.")},e[38]=U,e[39]=o,e[40]=se):se=e[40];const de=se;let ne;e[41]!==o?(ne=a=>{H(o[a]),B(a),N(!0)},e[41]=o,e[42]=ne):ne=e[42];const ge=ne;let ie;e[43]!==o?(ie=a=>{const{active:n,over:u}=a;if(!u||n.id===u.id)return;const k=o.findIndex(K=>K.id===n.id||K.tempId===n.id),L=o.findIndex(K=>K.id===u.id||K.tempId===u.id),Qe=Ae(o,k,L).map(ze);s(Qe)},e[43]=o,e[44]=ie):ie=e[44];const ye=ie;let le;e[45]===Symbol.for("react.memo_cache_sentinel")?(le=(a,n)=>{s(u=>u.map((k,L)=>L===a?{...k,point:n,updated:!0}:k))},e[45]=le):le=e[45];const xe=le;let ae;e[46]!==t||e[47]!==$||e[48]!==o||e[49]!==O?(ae=()=>{const a=o.filter(Ge),n=o.filter(He);if(a.length===0&&n.length===0){ue.info("No changes to submit.");return}a.forEach(u=>$(u)),n.forEach(u=>O(u)),p(o),localStorage.removeItem(pe(t)),J(!1),ue.success("All changes saved.")},e[46]=t,e[47]=$,e[48]=o,e[49]=O,e[50]=ae):ae=e[50];const he=ae;let ce;return e[51]!==m||e[52]!==S||e[53]!==fe||e[54]!==de||e[55]!==ye||e[56]!==ge||e[57]!==he||e[58]!==T||e[59]!==j||e[60]!==I||e[61]!==o||e[62]!==A||e[63]!==C||e[64]!==h||e[65]!==g?(ce={questions:o,setQuestions:s,isLoading:j,hasChanges:T,isModalOpen:I,selectedQuestion:C,editIndex:S,totalScore:h,setTotalScore:R,typePercentages:g,setTypePercentages:V,autoPoints:m,setAutoPoints:q,setModalOpen:N,handleAddQuestion:fe,handleEdit:ge,handleDelete:de,handleDragEnd:ye,handlePointChange:xe,handleSubmitAll:he,recalculatePoints:A},e[51]=m,e[52]=S,e[53]=fe,e[54]=de,e[55]=ye,e[56]=ge,e[57]=he,e[58]=T,e[59]=j,e[60]=I,e[61]=o,e[62]=A,e[63]=C,e[64]=h,e[65]=g,e[66]=ce):ce=e[66],ce};function Ue(t,e){const r=e.type||"Unknown";return t[r]=t[r]?[...t[r],e]:[e],t}function Ke(t){return{id:t.id??t.tempId,point:t.point}}function Be(t,e){return{...t,order:e+1}}function Je(t,e){return{...t,order:e+1}}function Re(t,e){return{...t,order:e+1}}function ze(t,e){return{...t,order:e+1,updated:!0}}function Ge(t){return t.isNew}function He(t){return t.updated}function Ao(t){const e=z.c(47),{assessmentId:r}=t,{questions:o,isLoading:s,hasChanges:i,isModalOpen:l,selectedQuestion:p,editIndex:d,setModalOpen:c,handleAddQuestion:F,handleEdit:D,handleDelete:G,handleDragEnd:S,handleSubmitAll:B,totalScore:C,setTotalScore:H,typePercentages:I,setTypePercentages:N,autoPoints:T,setAutoPoints:J,setQuestions:h}=Te(r);if(s){let w;return e[0]===Symbol.for("react.memo_cache_sentinel")?(w=b.jsx("div",{className:"flex h-64 items-center justify-center",children:b.jsx("p",{className:"animate-pulse font-medium text-description",children:"Loading questions..."})}),e[0]=w):w=e[0],w}let R;e[1]!==o?(R=Object.entries(o.reduce(We,{})).map(Ve),e[1]=o,e[2]=R):R=e[2];const P=R;let g;e[3]!==h?(g=w=>{h(w)},e[3]=h,e[4]=g):g=e[4];const V=g;let m;e[5]!==c?(m=()=>c(!0),e[5]=c,e[6]=m):m=e[6];let q;e[7]!==B||e[8]!==i||e[9]!==m?(q=b.jsx(Ee,{onAdd:m,onSave:B,hasChanges:i}),e[7]=B,e[8]=i,e[9]=m,e[10]=q):q=e[10];let v;e[11]!==G||e[12]!==S||e[13]!==D||e[14]!==o?(v=b.jsx($e,{questions:o,onEdit:D,onDelete:G,onDragEnd:S}),e[11]=G,e[12]=S,e[13]=D,e[14]=o,e[15]=v):v=e[15];let j;e[16]!==q||e[17]!==v?(j=b.jsx("div",{className:"min-w-0 flex-1 overflow-hidden rounded-2xl border border-border bg-card shadow-sm",children:b.jsxs("div",{className:"p-6 space-y-4",children:[q,v]})}),e[16]=q,e[17]=v,e[18]=j):j=e[18];let Q;e[19]!==T||e[20]!==P||e[21]!==J||e[22]!==H||e[23]!==N||e[24]!==C||e[25]!==I?(Q=b.jsx(ke,{totalScore:C,setTotalScore:H,typePercentages:I,setTypePercentages:N,questionTypes:P,autoPoints:T,setAutoPoints:J}),e[19]=T,e[20]=P,e[21]=J,e[22]=H,e[23]=N,e[24]=C,e[25]=I,e[26]=Q):Q=e[26];let y;e[27]!==V||e[28]!==o?(y=b.jsx(Oe,{questions:o,onSave:V}),e[27]=V,e[28]=o,e[29]=y):y=e[29];let $;e[30]!==Q||e[31]!==y?($=b.jsxs("aside",{className:"w-full space-y-6 lg:w-[380px]",children:[Q,y]}),e[30]=Q,e[31]=y,e[32]=$):$=e[32];let O;e[33]!==c?(O=()=>c(!1),e[33]=c,e[34]=O):O=e[34];const U=d!==null?o[d]:void 0;let x;e[35]!==r||e[36]!==F||e[37]!==l||e[38]!==p||e[39]!==c||e[40]!==O||e[41]!==U?(x=b.jsx(je,{assessmentId:r,isOpen:l,setIsOpen:c,onClose:O,onSave:F,question:p,defaultData:U}),e[35]=r,e[36]=F,e[37]=l,e[38]=p,e[39]=c,e[40]=O,e[41]=U,e[42]=x):x=e[42];let M;return e[43]!==x||e[44]!==j||e[45]!==$?(M=b.jsxs("div",{className:" flex animate-in flex-col gap-6 p-4 duration-700 fade-in lg:flex-row bg-background",children:[j,$,x]}),e[43]=x,e[44]=j,e[45]=$,e[46]=M):M=e[46],M}function Ve(t){const[e,r]=t;return{type:e,count:r}}function We(t,e){return e?.type&&(t[e.type]=(t[e.type]||0)+1),t}export{Ao as default};
