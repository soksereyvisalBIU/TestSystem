import{d as K,r as o,u as X,j as e}from"./app-DOexATz8.js";import{Q as Z}from"./QuestionRenderer-CXH3MBWS.js";import{B as A}from"./badge-CPBjG4_l.js";import{B as c}from"./button-BRVN6i6H.js";import{d as T,c as D,D as E,b as Q,a as L,e as U}from"./dialog-TFrJjmZh.js";import{c as p}from"./utils-CFcDjcb_.js";import{s as _}from"./index-ikzcNs2d.js";import{C as q}from"./circle-check-big-DiLSee33.js";import{L as M}from"./list-ordered-Dma-l0eK.js";import{C as ee}from"./clock-JNa168ul.js";import{T as te}from"./triangle-alert-P1pcZk7Y.js";import"./app-Dkd-uU77.js";import"./hard-drive-C7ThFyw9.js";import"./createLucideIcon-j6D0D3Y_.js";import"./image-CZbZ8_rj.js";import"./maximize-2-O5BVre8P.js";import"./loader-circle-xDQqgRtj.js";import"./upload-C5XbYVl2.js";import"./file-iwSUTVYm.js";import"./circle-check-BbXVY_J9.js";import"./x-xRkXIo8D.js";import"./chevron-left-BwAIY23A.js";import"./chevron-right-CqdRtJ2F.js";import"./textarea-BsNou_JT.js";import"./label-B8z-0cNd.js";import"./index-CsaJF3T3.js";import"./index-Dghi0PCu.js";import"./circle-alert-_35u1DpG.js";import"./command-BJUssI3G.js";import"./index-BiXTY-N1.js";import"./index-DM2N5xoF.js";import"./search-BJrQLS36.js";import"./popover-C4Np6-RM.js";import"./index-BZcpqnGn.js";import"./index-BEPutMgU.js";import"./index-CbEB6B2s.js";import"./index-DI0Uf7dS.js";import"./index-CPEYA-OZ.js";import"./index-D8NCBvGj.js";import"./arrow-right-Cr5VBfnV.js";import"./chevron-up-_obE1ikU.js";import"./grip-horizontal-BNCbtw4K.js";import"./circle-help-a1QgAAb2.js";import"./index-Z9JsAk8n.js";import"./index-D2V0qVjz.js";import"./index-BF4E9qjg.js";import"./circle-BdnuV9lG.js";import"./index-DTzCHv86.js";import"./index-C5FbGKEL.js";import"./with-selector-CQBRQGj8.js";import"./index-BCjrxXRD.js";import"./select-CH_F3wFZ.js";import"./index-C8DTQ8L6.js";import"./check-B5V9zjb2.js";import"./list-CH_oBRHj.js";import"./type-Ce9inCyE.js";import"./info-CrSviemM.js";import"./circle-x-Bx2T49Oq.js";import"./index-DQ5CcXw7.js";import"./index-CHXMgrNC.js";const se=i=>{if(i<0)return"00:00:00";const d=Math.floor(i/3600),m=Math.floor(i%3600/60),b=i%60;return[d,m,b].map(j=>j.toString().padStart(2,"0")).join(":")};function ct({assessment:i,questions:d,studentAssessmentAttempt:m,student_assessment_attempt_id:b}){const{props:j}=K(),C=i.subjects[0],l=m.status!=="draft",[n,R]=o.useState({}),[B,u]=o.useState(!1),[O,x]=o.useState(!1),[k,Y]=o.useState([]),[w,z]=o.useState(null),N=o.useRef({}),P=()=>{if(l||!i.duration)return 0;const t=i.duration*60,s=new Date(m.started_at).getTime(),r=Date.now(),S=Math.floor((r-s)/1e3);return Math.max(0,t-S)},$=o.useMemo(P,[i.duration,m.started_at,l]),[f,F]=o.useState($),[g,V]=o.useState(f===0&&i.duration>0);o.useEffect(()=>{if(i.duration===0||l)return;const t=setInterval(()=>{F(s=>s<=1?(clearInterval(t),V(!0),v(),0):s-1)},1e3);return()=>clearInterval(t)},[i.duration,l]);const G=se(f),H=f<=300&&f>0?"bg-red-500 text-white":f>0?"bg-primary text-primary-foreground":"bg-red-700 text-white",a=X({answers:{},user_id:j?.auth?.user?.id}),I=t=>{const s=document.getElementById(`question-${t}`);s&&(u(!1),x(!1),s.scrollIntoView({behavior:"smooth",block:"start"}))},W=(t,s)=>{l||R(r=>({...r,[t]:s}))},v=()=>{a.processing||l||(a.transform(t=>({...t,answers:n})),a.post(_("student.classes.subjects.assessments.attempt.store",{class_id:C.class_id,subject_id:C.id,assessment_id:i.id,student_assessment_attempt_id:b}),{onError:t=>{console.error("Submission Error:",t)}}))},J=()=>{if(a.processing||l)return;const t=d.data.filter(s=>n[s.id]===void 0||n[s.id]===null||n[s.id]==="");if(Y(t),t.length>0){u(!1),x(!0);return}u(!1),v()};o.useEffect(()=>{const t=new IntersectionObserver(s=>{s.forEach(r=>{const S=parseInt(r.target.id.replace("question-",""),10);r.isIntersecting&&r.intersectionRatio>=.5&&z(S)})},{root:null,rootMargin:"0px",threshold:.5});return d.data.forEach(s=>{const r=N.current[s.id];r&&t.observe(r)}),()=>{d.data.forEach(s=>{const r=N.current[s.id];r&&t.unobserve(r)})}},[d.data]);const y=o.useMemo(()=>d.data.map((t,s)=>({id:t.id,index:s,isAnswered:n[t.id]!==void 0&&n[t.id]!==null&&n[t.id]!=="",questionText:t.question})),[d.data,n]),h=y.filter(t=>!t.isAnswered).length;return l?e.jsx("div",{className:"flex min-h-screen items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md rounded-lg border bg-card p-8 text-center shadow-lg",children:[e.jsx(q,{className:"mx-auto h-16 w-16 text-green-500"}),e.jsx("h1",{className:"mt-4 text-2xl font-bold",children:"Assessment Completed"}),e.jsxs("p",{className:"mt-2 text-muted-foreground",children:["Your submission has been recorded on **",new Date(m.updated_at).toLocaleDateString(),"** at **",new Date(m.updated_at).toLocaleTimeString(),"**."]}),e.jsx(c,{asChild:!0,className:"mt-6",children:e.jsx("span",{children:"View Results (Link Placeholder)"})})]})}):e.jsxs("div",{className:"relative flex min-h-screen",children:[e.jsx("div",{className:"fixed top-0 left-0 z-20 hidden h-full w-64 overflow-y-auto border-r bg-card pt-20 lg:block",children:e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 border-b pb-2 text-lg font-semibold",children:[e.jsx(M,{className:"h-5 w-5 text-primary"}),"Questions (",d.data.length,")"]}),e.jsxs("div",{className:"flex justify-around text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-green-500"})," ","Answered"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-primary"})," ","Current"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"h-2 w-2 rounded-full border border-input bg-white"})," ","Unanswered"]})]}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:y.map(t=>e.jsx(c,{variant:w===t.id?"default":t.isAnswered?"secondary":"outline",size:"icon",className:p("h-10 w-10 text-sm font-semibold transition-colors",w===t.id?"bg-primary text-primary-foreground shadow-lg":t.isAnswered?"bg-green-500 text-white hover:bg-green-600":"hover:bg-accent/80"),onClick:()=>I(t.id),title:`Question ${t.index+1}: ${t.isAnswered?"Answered":"Unanswered"}`,children:t.index+1},t.id))}),e.jsx("div",{className:"border-t pt-4",children:e.jsx(c,{onClick:()=>u(!0),className:"h-10 w-full text-lg font-bold",disabled:g||a.processing||l,variant:h>0?"outline":"default",children:a.processing?"Submitting...":"End Assessment"})})]})}),e.jsxs("div",{className:"flex-1 pb-24 lg:ml-64",children:[" ",e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6 px-4 py-10",children:[e.jsxs("header",{className:"space-y-2 border-b pb-4 text-center",children:[e.jsx("h1",{className:"text-4xl font-extrabold tracking-tight",children:i.title}),e.jsx("p",{className:"text-md text-muted-foreground",children:i.description})]}),e.jsx("div",{className:"space-y-8",children:d?.data?.map((t,s)=>e.jsxs("div",{id:`question-${t.id}`,ref:r=>N.current[t.id]=r,className:p("rounded-xl border bg-card p-6 shadow-xl transition-all duration-300",w===t.id?"scale-[1.005] border-primary shadow-2xl":""),children:[e.jsxs("h2",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-2xl font-bold text-primary",children:[e.jsx("span",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary font-mono text-sm text-white",children:s+1}),"Question ",s+1]}),e.jsx(Z,{question:t,index:s,answer:n[t.id],onAnswerChange:W,disabled:l||g},t.id),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(A,{variant:n[t.id]?"default":"secondary",className:p("px-3 py-1 text-sm",n[t.id]?"bg-green-100 text-green-700 hover:bg-green-100":"bg-muted text-muted-foreground"),children:n[t.id]?"Answered":"Unanswered"})})]},t.id))}),e.jsx("div",{className:"flex justify-end py-10",children:e.jsx(c,{onClick:()=>u(!0),size:"lg",className:"h-12 px-8 text-lg",disabled:g||a.processing||l,variant:h>0?"outline":"default",children:a.processing?"Submitting...":"Submit Assessment"})})]})]}),i.duration>0&&e.jsxs("div",{className:p("fixed right-4 bottom-4 z-50 transform cursor-default rounded-xl border-4 border-white p-4 text-center shadow-2xl transition-all duration-500 hover:scale-[1.02]",H),children:[e.jsxs("div",{className:"mb-1 flex items-center justify-center gap-2 text-xs font-medium uppercase opacity-90",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:"Time Remaining"})]}),e.jsx("div",{className:"font-mono text-4xl font-bold tracking-wider",children:G}),g&&e.jsx("p",{className:"mt-1 animate-pulse text-sm font-bold",children:"TIME IS UP! Auto-Submitting..."})]}),e.jsx(T,{open:B,onOpenChange:u,children:e.jsxs(D,{className:"max-w-lg",children:[e.jsxs(E,{className:"justify-center sm:text-center",children:[e.jsx("img",{className:"mx-auto max-w-32 rounded-full p-2",src:"/assets/img/assessment/submit.gif",alt:"Confirm Submit"}),e.jsx(Q,{className:"text-2xl font-bold",children:"Confirm Submission"}),e.jsx(L,{className:"pt-2 text-base text-muted-foreground",children:"You are about to submit your assessment. Please review the summary below."})]}),e.jsxs("p",{className:"text-center text-lg font-semibold",children:["You have **",e.jsx("span",{className:p("font-extrabold",h>0?"text-red-600":"text-green-600"),children:h}),"** unanswered questions."]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md border bg-muted/30 p-4",children:[e.jsxs("h4",{className:"mb-3 flex items-center gap-2 border-b pb-2 text-lg font-bold",children:[e.jsx(M,{className:"h-5 w-5"})," Review Summary:"]}),y.map(t=>e.jsxs("div",{className:"mb-2 flex items-center justify-between rounded p-1 text-sm transition-colors duration-200 hover:bg-muted/50",children:[e.jsxs("p",{className:"truncate text-xs font-medium opacity-90",children:[t.index+1,". ",t.questionText]}),e.jsx(A,{className:p("ml-2 flex min-w-20 justify-center",t.isAnswered?"bg-green-500 text-white hover:bg-green-600":"bg-red-500 text-white hover:bg-red-600"),children:t.isAnswered?"Answered":"Skipped"})]},t.id))]}),e.jsxs(U,{className:"pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(c,{onClick:()=>{J()},disabled:a.processing,variant:h>0?"outline":"default",children:a.processing?"Submitting...":"Yes, Submit Anyway"})]})]})}),e.jsx(T,{open:O,onOpenChange:x,children:e.jsxs(D,{className:"max-w-lg",children:[e.jsxs(E,{className:"justify-center sm:text-center",children:[e.jsx("img",{className:"mx-auto max-w-32 rounded-full p-2",src:"/assets/img/assessment/wanted.gif",alt:"Warning"}),e.jsxs(Q,{className:"text-2xl font-bold text-red-600",children:[e.jsx(te,{className:"mr-2 inline-block h-6 w-6"})," ","Unanswered Questions Found"]}),e.jsx(L,{className:"pt-2 text-base text-muted-foreground",children:"You have unanswered questions. It is recommended to go back and complete them."})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md border bg-muted/30 p-4",children:[e.jsxs("h4",{className:"mb-3 border-b pb-2 text-lg font-bold text-red-700",children:["Unanswered List (",k.length,"):"]}),k.map(t=>{const s=d.data.findIndex(r=>r.id===t.id);return e.jsx("div",{className:"mb-2",children:e.jsxs(c,{variant:"link",className:"h-auto justify-start p-0 text-left text-sm font-medium text-red-600 transition-colors duration-200 hover:text-red-700 hover:no-underline",onClick:()=>{x(!1),I(t.id)},children:[e.jsxs("span",{className:"mr-2 font-extrabold underline",children:["Q",s+1,":"]}),e.jsx("span",{className:"max-w-[85%] truncate",children:t.question.length>80?t.question.substring(0,77)+"...":t.question})]})},t.id)})]}),e.jsxs(U,{className:"pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>x(!1),className:"font-semibold",children:"Go Back to Questions"}),e.jsx(c,{className:"bg-red-600 font-semibold text-white hover:bg-red-700",onClick:()=>{x(!1),v()},disabled:a.processing,children:a.processing?"Submitting...":"Submit Anyway"})]})]})})]})}export{ct as default};
