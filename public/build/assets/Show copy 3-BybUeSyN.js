import{a as i,j as e,H as L}from"./app-BEjprfpt.js";import{A as T}from"./app-layout-DfQQ_XDM.js";import{d as B}from"./dayjs.min-ELk8fNw-.js";import{z as w}from"./index-BYiI1tkd.js";import{B as k}from"./badge-DVoRCxHz.js";import{B as u}from"./button-DGod-GTx.js";import{b as y,d as F,C as z,c as G}from"./card-BaYWL8Gi.js";import{S as H}from"./separator-ZVvIb-Ml.js";import{c as f}from"./utils-CFcDjcb_.js";import{QuestionRenderer as P}from"./QuestionRenderer-Bz0HjfpV.js";import{calculateAutoScore as q}from"./calculateAutoScore-DDBuE_7w.js";import{C as D}from"./chevron-left-D86TscZg.js";import{Z as R}from"./zap-CTxTQDCk.js";import{M as O}from"./mouse-pointer-2-COt6Addl.js";import{L as Q}from"./loader-circle-bmERupY8.js";import{C as Z}from"./circle-check-D0q-_Uz_.js";import"./app-C2HJU6IN.js";import"./index-sZL0LmKN.js";import"./index-joJZZ6T8.js";import"./index-CHXMgrNC.js";import"./dialog-isigwEAQ.js";import"./index-DsHUgfkw.js";import"./index-CVovHSZ1.js";import"./index-Db_ipX0A.js";import"./index-DH1X2cpJ.js";import"./index-rsEto4aw.js";import"./index-DU3jUZ6J.js";import"./index-Da8MCGzP.js";import"./x-9rjc8L--.js";import"./createLucideIcon-SD458vc9.js";import"./tooltip-CpjmRnmA.js";import"./index-Brhvp-qm.js";import"./index-Bnui9FJL.js";import"./index-COWxmS2u.js";import"./index-dA-rYMbt.js";import"./index-CBL-cnJN.js";import"./avatar-Dgk1JwKp.js";import"./index-CI6TeYZF.js";import"./index-BZB35nAZ.js";import"./index-CMWG4mbA.js";import"./command-CmqXW0w-.js";import"./search-BL-QF0Rx.js";import"./index-ikzcNs2d.js";import"./app-logo-icon-BXO135UB.js";import"./layout-grid-BLMpB1Jf.js";import"./users-D2d18B4g.js";import"./settings-2-BMKDjTqy.js";import"./cpu-BLXfwEsG.js";import"./book-open-CRzmW_vb.js";import"./chevron-right-CrOEsWah.js";import"./appearance-tabs-header-CsIvXzNJ.js";import"./sun-CRFjhy0H.js";import"./ChoiceQuestion-CXr4o1cG.js";import"./sparkles-CUsC-2pB.js";import"./check-DNy6Q5Gp.js";import"./FileQuestion-zXgq0Oke.js";import"./file-text-BTi6k94-.js";import"./maximize-2-DCf6e0vk.js";import"./file-BoRE40qY.js";import"./clock-C_uYab5X.js";import"./eye-qNFWh0j6.js";import"./download-DACYvbKS.js";import"./copy-CKNCpahE.js";import"./MatchingQuestion-C-x-dFMV.js";import"./arrow-right-C6kumotC.js";import"./TextQuestion-ZfSQVTSb.js";import"./label-tp4e9AWt.js";import"./code-xml-ATM5qUgc.js";import"./circle-alert-BPPGSlpv.js";import"./file-up-C1yOACBt.js";import"./pen-line-DESckUgy.js";import"./save-DPqs5y9_.js";import"./circle-help-C5KnjDZQ.js";import"./circle-x-CsKtQwFL.js";function ms({assessment:n,attempt:o}){const[d,S]=i.useState(o.answers||[]),[b,g]=i.useState(!1),[m,j]=i.useState(null),C=i.useMemo(()=>d.reduce((s,t)=>(s[t.question_id]=s[t.question_id]||[],s[t.question_id].push(t),s),{}),[d]),a=i.useMemo(()=>{let s=0,t=0,c=0,l=0;const E=n.questions.map(x=>{const p=d.filter(I=>I.question_id===x.id),r=p?.[0]?.manual_score,h=q(x,p),N=parseFloat(x.point||0);let v=r!=null&&r!==""?parseFloat(r):p?.[0]?.point_earned??h.earnedPoints;return s+=v,t+=N,r!=null&&l++,h.status==="correct"&&r==null&&c++,{id:x.id,earned:v,max:N,isManual:r!=null,status:h.status}});return{totalEarned:s,totalMax:t,autoCorrectCount:c,manualOverrideCount:l,details:E}},[n.questions,d]),_=a.totalMax>0?(a.totalEarned/a.totalMax*100).toFixed(1):0,A=(s,t)=>{S(c=>c.map(l=>l.question_id===s?{...l,manual_score:t}:l)),j("pending")},M=async()=>{g(!0);try{await new Promise(s=>setTimeout(s,800)),w.success("All grades finalized"),j(new Date)}catch{w.error("Sync failed")}finally{g(!1)}};return e.jsxs(T,{breadcrumbs:[{title:"Assessments",href:"/assessments"},{title:"Grading"}],children:[e.jsx(L,{title:`Grading: ${o.student?.name}`}),e.jsxs("div",{className:"min-h-screen bg-[#FBFBFE] pb-40",children:[e.jsx("header",{className:"sticky top-0 z-50 w-full border-b bg-white/90 backdrop-blur-xl",children:e.jsx("div",{className:"mx-auto max-w-[1400px] px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(u,{variant:"ghost",size:"icon",className:"group h-10 w-10 rounded-xl bg-slate-50 hover:bg-slate-100",onClick:()=>window.history.back(),children:e.jsx(D,{className:"h-5 w-5 transition-transform group-hover:-translate-x-1"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-xl font-black tracking-tight text-slate-900",children:o.student?.name}),e.jsxs(k,{variant:"outline",className:"h-5 px-1.5 text-[9px] font-black tracking-widest text-slate-400 uppercase",children:["Student ID: ",o.student_id]})]}),e.jsxs("p",{className:"flex items-center gap-2 text-xs font-bold tracking-tight text-slate-500 uppercase",children:[n.title,e.jsx("span",{className:"h-1 w-1 rounded-full bg-slate-300"}),e.jsx(R,{className:"h-3 w-3 fill-amber-500 text-amber-500"}),"Live Grading Session"]})]})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"hidden gap-10 border-r border-slate-100 pr-10 xl:flex",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Auto-Points"}),e.jsxs("p",{className:"text-sm font-black text-slate-700",children:[a.autoCorrectCount," Items"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Manual Adjust"}),e.jsxs("p",{className:"text-sm font-black text-indigo-600",children:[a.manualOverrideCount," Items"]})]})]}),e.jsxs("div",{className:"flex items-center gap-5 rounded-[22px] bg-slate-950 p-1.5 pl-6 text-white shadow-2xl shadow-slate-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black tracking-[0.2em] text-slate-500 uppercase",children:"Current Score"}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-black text-white",children:a.totalEarned}),e.jsxs("span",{className:"text-xs font-bold text-slate-500",children:["/ ",a.totalMax]})]})]}),e.jsxs("div",{className:"flex h-12 w-20 flex-col items-center justify-center rounded-[18px] bg-emerald-500",children:[e.jsxs("span",{className:"text-sm leading-none font-black",children:[_,"%"]}),e.jsx("span",{className:"mt-0.5 text-[8px] font-bold tracking-tighter uppercase opacity-80",children:"Grade"})]})]})]})]})})}),e.jsx("div",{className:"mx-auto mt-10 max-w-[1400px] px-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-10 lg:grid-cols-12",children:[e.jsx("aside",{className:"hidden lg:col-span-3 lg:block",children:e.jsxs("div",{className:"sticky top-28 space-y-6",children:[e.jsxs(y,{className:"overflow-hidden rounded-[24px] border-none shadow-[0_4px_20px_rgba(0,0,0,0.03)] ring-1 ring-slate-200/60",children:[e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"mb-5 flex items-center justify-between",children:[e.jsx("h3",{className:"text-[11px] font-black tracking-widest text-slate-400 uppercase",children:"Assessment Navigator"}),m==="pending"&&e.jsx("span",{className:"flex h-2 w-2 animate-ping rounded-full bg-indigo-500"})]}),e.jsx("div",{className:"space-y-2",children:a.details.map((s,t)=>e.jsxs("a",{href:`#q-${s.id}`,className:f("group flex items-center justify-between rounded-xl p-3 transition-all",s.isManual?"bg-indigo-50/80 ring-1 ring-indigo-200":"border border-transparent bg-white hover:border-slate-200 hover:bg-slate-50"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("flex h-6 w-6 items-center justify-center rounded-lg text-[10px] font-black",s.isManual?"bg-indigo-600 text-white":"bg-slate-100 text-slate-400 group-hover:bg-slate-200"),children:t+1}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[11px] font-bold text-slate-700",children:"Question"}),s.isManual&&e.jsx("span",{className:"text-[8px] leading-none font-black text-indigo-400 uppercase",children:"Edited"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:f("text-xs font-black",s.earned===s.max?"text-emerald-500":s.earned>0?"text-amber-500":"text-slate-300"),children:[s.earned,e.jsxs("span",{className:"text-[9px] opacity-40",children:["/",s.max]})]})})]},s.id))})]}),e.jsx("div",{className:"border-t border-slate-100 bg-slate-50 px-5 py-4",children:e.jsxs("div",{className:"flex items-center justify-between text-[10px] font-black text-slate-400 uppercase",children:[e.jsx("span",{children:"Session Sync"}),e.jsx("span",{children:m instanceof Date?B(m).format("HH:mm:ss"):"Ready"})]})})]}),e.jsxs("div",{className:"rounded-2xl border border-dashed border-slate-200 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(O,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"text-[10px] font-bold tracking-widest text-slate-400 uppercase",children:"Pro Tips"})]}),e.jsxs("p",{className:"text-[10px] leading-relaxed text-slate-500",children:["Use"," ",e.jsx("kbd",{className:"rounded border bg-white px-1 py-0.5 text-[9px] font-bold",children:"MAX"})," ","buttons for full-credit speed grading. Manual overrides are saved as drafts until final sync."]})]})]})}),e.jsx("main",{className:"space-y-12 lg:col-span-9",children:n.questions.map((s,t)=>e.jsx("section",{id:`q-${s.id}`,className:"scroll-mt-32",children:e.jsxs(y,{className:"group relative overflow-hidden rounded-[32px] border-none shadow-[0_10px_40px_rgba(0,0,0,0.02)] ring-1 ring-slate-200/70 transition-all hover:ring-slate-300",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 border-b border-slate-50/50 bg-white px-10 py-6",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-slate-900 text-base font-black text-white shadow-xl shadow-slate-200",children:t+1}),e.jsx("div",{className:"absolute -top-1 -right-1 h-3 w-3 rounded-full border-2 border-white bg-emerald-500"})]}),e.jsxs("div",{children:[e.jsxs(z,{className:"text-xs font-black tracking-[0.15em] text-slate-400 uppercase",children:["Question Category:"," ",s.type.replace("_"," ")]}),e.jsx("h4",{className:"mt-0.5 text-sm font-bold text-slate-800",children:"Learning Objective Reference"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(k,{variant:"outline",className:"h-7 border-slate-200 px-3 text-[10px] font-black text-slate-500",children:["WEIGHT: ",s.point," PTS"]})})]}),e.jsx(G,{className:"p-10",children:e.jsx(P,{question:s,answers:C[s.id]||[],onTeacherScore:A})})]})},s.id))})]})}),e.jsx("div",{className:"fixed bottom-10 left-1/2 z-[60] w-full max-w-4xl -translate-x-1/2 px-6",children:e.jsxs("div",{className:"flex items-center justify-between rounded-[32px] border border-white/20 bg-slate-950/95 p-4 pl-10 shadow-[0_30px_100px_rgba(0,0,0,0.4)] ring-1 ring-white/10 backdrop-blur-2xl",children:[e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-black tracking-widest text-slate-500 uppercase",children:"Live Aggregate"}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-black text-white",children:a.totalEarned}),e.jsxs("span",{className:"text-xs font-bold text-slate-500",children:["/ ",a.totalMax]})]})]}),e.jsx(H,{orientation:"vertical",className:"h-10 bg-slate-800"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-black tracking-widest text-slate-500 uppercase",children:"Total Adjusted"}),e.jsxs("span",{className:"text-lg font-black text-indigo-400",children:[a.manualOverrideCount," ",e.jsx("span",{className:"text-[10px] text-slate-600",children:"Items"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{variant:"ghost",className:"h-14 rounded-2xl px-8 font-black text-slate-400 transition-colors hover:bg-slate-900 hover:text-white",onClick:()=>window.history.back(),children:"Discard Session"}),e.jsxs(u,{onClick:M,disabled:b,className:"h-14 rounded-[22px] bg-white px-12 text-sm font-black text-slate-950 shadow-xl transition-all hover:bg-emerald-400 hover:text-slate-950 active:scale-95",children:[b?e.jsx(Q,{className:"mr-2 h-5 w-5 animate-spin"}):e.jsx(Z,{className:"mr-2 h-5 w-5"}),"SYNC & FINALIZE GRADE"]})]})]})})]})]})}export{ms as default};
