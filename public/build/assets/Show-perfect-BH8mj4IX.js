import{a as T,j as t,H as L,c as A}from"./app-C4-wZLjv.js";import{A as M}from"./app-layout-CNHzTDPv.js";import{d as E}from"./dayjs.min-6cGuIIDv.js";import{z as F}from"./index-pPUi9S1_.js";import{s as q}from"./index-ikzcNs2d.js";import{Card as O,CardHeader as Q,CardContent as R,Badge as B}from"./Card-Df1VI-b5.js";import"./app-Ctpas7OY.js";import"./index-CmRgzCPv.js";import"./index-Buz4j_7Y.js";import"./index-CHXMgrNC.js";import"./utils-CFcDjcb_.js";import"./button-BtXHUDlw.js";import"./dialog-C5dD38AA.js";import"./index-DeD9CSgl.js";import"./index-CNKjpVcS.js";import"./index-Xko6ReMJ.js";import"./index-C3tRsT71.js";import"./index-Bhes_7Zs.js";import"./index-cZrIM-8D.js";import"./index-ChzAp34M.js";import"./x-cYyiHa3X.js";import"./createLucideIcon-DDKIJ2e3.js";import"./tooltip-i2vZDwaq.js";import"./index-BthvL4JC.js";import"./index-CeYVXcUJ.js";import"./index-Clov3BKf.js";import"./index-BmIIwECa.js";import"./index-DRemKmJw.js";import"./avatar-DWKof1ni.js";import"./index-C2fpaiMf.js";import"./index-BZB35nAZ.js";import"./index-CMWG4mbA.js";import"./command-HKHPfprr.js";import"./search-Cxo_qDnu.js";import"./app-logo-icon-BJ5tEmQI.js";import"./layout-grid-CEBlWw-x.js";import"./users-CUYIQcdw.js";import"./settings-2-DUZge6eM.js";import"./cpu-DrMaJJL5.js";import"./book-open-DhnomZaK.js";import"./chevron-right-CZckLAVz.js";import"./appearance-tabs-header-DkuhK1KQ.js";import"./sun-DVv0vIb6.js";const $=(i,e=[])=>{const r=parseFloat(i.point||0);let c=0,a="unanswered";if(e.length===0)return{earnedPoints:c,maxPoints:r,status:a};const n=e[0];switch(i.type){case"true_false":case"multiple_choice":{const d=i.options.find(l=>l.is_correct===1);d&&n.answer_text===d.option_text?(c=r,a="correct"):a="incorrect";break}case"fill_blank":case"short_answer":{i.options.find(l=>l.option_text.trim().toLowerCase()===(n.answer_text||"").trim().toLowerCase())?(c=r,a="correct"):a="review";break}case"matching":{const d=i.options.length,l=d?r/d:0;let x=0;i.options.forEach(m=>{const o=e.find(s=>s.option_id===m.id);o&&o.answer_text===m.match_key&&x++}),c=x*l,a=x===d?"correct":x===0?"incorrect":"partial";break}}return{earnedPoints:+c.toFixed(2),maxPoints:+r.toFixed(2),status:a}},Y=i=>{const e={correct:"border border-green-200 bg-green-100 text-green-700",incorrect:"border border-red-200 bg-red-100 text-red-700",partial:"border border-yellow-200 bg-yellow-100 text-yellow-800",review:"border border-orange-200 bg-orange-100 text-orange-800",default:"border border-gray-200 bg-gray-100 text-gray-600"},r={correct:"Correct",incorrect:"Incorrect",partial:"Partially Correct",review:"Needs Review",default:"No Answer"};return t.jsx(B,{className:e[i]||e.default,children:r[i]||r.default})},H=i=>{const e=A.c(7),{question:r,answers:c}=i;let a;if(e[0]!==c||e[1]!==r.options){let d;e[3]!==c?(d=l=>{const m=c.find(s=>s.option_id===l.id)?.answer_text||"—",o=m===l.match_key;return t.jsxs("div",{className:`flex flex-col items-start justify-between rounded-lg border p-3 sm:flex-row sm:items-center ${o?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[t.jsx("div",{className:"mb-2 w-full font-medium text-gray-700 sm:mb-0 sm:w-1/2",children:l.option_text}),t.jsx("div",{className:"mx-4 hidden text-gray-400 sm:block",children:"→"}),t.jsxs("div",{className:"flex w-full flex-col items-end gap-1 sm:w-1/2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs font-semibold tracking-wider text-gray-500 uppercase",children:"Student:"}),t.jsx("span",{className:`font-medium ${o?"text-green-700":"text-red-700"}`,children:m})]}),!o&&t.jsxs("div",{className:"rounded bg-green-100 px-2 py-1 text-xs text-green-700",children:["Correct: ",l.match_key]})]})]},l.id)},e[3]=c,e[4]=d):d=e[4],a=r.options.map(d),e[0]=c,e[1]=r.options,e[2]=a}else a=e[2];let n;return e[5]!==a?(n=t.jsx("div",{className:"mt-4 grid gap-3",children:a}),e[5]=a,e[6]=n):n=e[6],n},I=i=>{const e=A.c(7),{question:r,answers:c}=i,a=c[0]?.answer_text;let n;if(e[0]!==r.options||e[1]!==a){let l;e[3]!==a?(l=x=>{const m=a===x.option_text,o=x.is_correct===1;let s="border-gray-200 bg-white hover:bg-gray-50";return m&&o?s="border-green-300 bg-green-50 ring-1 ring-green-300":m&&!o?s="border-red-300 bg-red-50 ring-1 ring-red-300":!m&&o&&(s="border-green-300 bg-white ring-1 ring-green-300 border-dashed"),t.jsxs("div",{className:`flex items-center rounded-lg border p-3 transition-all ${s}`,children:[t.jsx("div",{className:`mr-3 flex h-5 w-5 items-center justify-center rounded-full border ${m?o?"border-green-500 bg-green-500 text-white":"border-red-500 bg-red-500 text-white":"border-gray-300"}`,children:m&&t.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})}),t.jsx("span",{className:`flex-1 ${o?"font-semibold text-gray-900":"text-gray-700"}`,children:x.option_text}),o&&!m&&t.jsx("span",{className:"px-2 text-xs font-medium text-green-600",children:"Correct Answer"})]},x.id)},e[3]=a,e[4]=l):l=e[4],n=r.options.map(l),e[0]=r.options,e[1]=a,e[2]=n}else n=e[2];let d;return e[5]!==n?(d=t.jsx("div",{className:"mt-4 space-y-2",children:n}),e[5]=n,e[6]=d):d=e[6],d},z=i=>{const e=A.c(31),{question:r,answers:c,onTeacherScore:a}=i,n=c[0]?.answer_text||"",d=r.options.map(J);let l;e[0]!==n?(l=C=>C.trim().toLowerCase()===n.trim().toLowerCase(),e[0]=n,e[1]=l):l=e[1];const x=d.some(l),[m,o]=T.useState(c[0]?.manual_score??""),s=parseFloat(r.point||0);let p;e[2]!==s||e[3]!==a||e[4]!==r.id?(p=C=>{let v=parseFloat(C);isNaN(v)&&(v=""),v>s&&(v=s),v<0&&(v=0),o(v),a?.(r.id,v)},e[2]=s,e[3]=a,e[4]=r.id,e[5]=p):p=e[5];const u=p,N="mt-4 space-y-4";let h;e[6]===Symbol.for("react.memo_cache_sentinel")?(h=t.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-500",children:"Your Answer"}),e[6]=h):h=e[6];const j=`rounded-md border p-3 ${x?"border-green-200 bg-green-50 text-green-800":"border-red-200 bg-red-50 text-red-800"}`;let b;e[7]!==n?(b=n||t.jsx("span",{className:"text-gray-400 italic",children:"No answer submitted"}),e[7]=n,e[8]=b):b=e[8];let y;e[9]!==j||e[10]!==b?(y=t.jsxs("div",{children:[h,t.jsx("div",{className:j,children:b})]}),e[9]=j,e[10]=b,e[11]=y):y=e[11];const k=!x&&d.length>0&&t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-green-700",children:"Expected Answer(s)"}),t.jsx("div",{className:"rounded-md border border-green-200 bg-white p-3 text-gray-700",children:t.jsx("ul",{className:"list-inside list-disc",children:d.map(K)})})]});let f;e[12]!==s?(f=t.jsxs("label",{className:"mb-2 block text-sm font-semibold text-gray-800",children:["Teacher Score (0 - ",s,")"]}),e[12]=s,e[13]=f):f=e[13];let g;e[14]!==u?(g=C=>u(C.target.value),e[14]=u,e[15]=g):g=e[15];let w;e[16]!==m||e[17]!==s||e[18]!==g?(w=t.jsx("input",{type:"number",min:"0",max:s,step:"0.25",value:m,onChange:g,className:"w-32 rounded-md border bg-white p-2 text-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Enter score"}),e[16]=m,e[17]=s,e[18]=g,e[19]=w):w=e[19];let _;e[20]!==m||e[21]!==s?(_=m!==""&&t.jsxs("p",{className:"mt-1 text-xs text-green-600",children:["Score saved: ",m," / ",s]}),e[20]=m,e[21]=s,e[22]=_):_=e[22];let S;e[23]!==w||e[24]!==_||e[25]!==f?(S=t.jsxs("div",{className:"border-t border-gray-100 pt-4",children:[f,w,_]}),e[23]=w,e[24]=_,e[25]=f,e[26]=S):S=e[26];let P;return e[27]!==S||e[28]!==y||e[29]!==k?(P=t.jsxs("div",{className:N,children:[y,k,S]}),e[27]=S,e[28]=y,e[29]=k,e[30]=P):P=e[30],P},D=i=>{const e=A.c(40),{question:r,answers:c,onTeacherScore:a}=i;let n,d,l,x,m,o,s,p;if(e[0]!==c||e[1]!==a||e[2]!==r){n=$(r,c);const y=c[0]?.manual_score;d=y??n.earnedPoints;const k=y!=null?"review":n.status;o="flex h-full flex-col",e[11]!==r.question_text?(s=t.jsx("div",{className:"mb-4 text-lg leading-relaxed font-medium text-gray-900",dangerouslySetInnerHTML:{__html:r.question_text}}),e[11]=r.question_text,e[12]=s):s=e[12];let f;e[13]!==c||e[14]!==r?(f=r.type==="matching"&&t.jsx(H,{question:r,answers:c}),e[13]=c,e[14]=r,e[15]=f):f=e[15];let g;e[16]!==c||e[17]!==r?(g=(r.type==="multiple_choice"||r.type==="true_false")&&t.jsx(I,{question:r,answers:c}),e[16]=c,e[17]=r,e[18]=g):g=e[18];const w=(r.type==="short_answer"||r.type==="fill_blank")&&t.jsx(z,{question:r,answers:c,onTeacherScore:a});e[19]!==f||e[20]!==g||e[21]!==w?(p=t.jsxs("div",{className:"flex-grow",children:[f,g,w]}),e[19]=f,e[20]=g,e[21]=w,e[22]=p):p=e[22],m="mt-6 flex items-center justify-between border-t border-gray-100 pt-4",l="flex items-center gap-3",x=Y(k),e[0]=c,e[1]=a,e[2]=r,e[3]=n,e[4]=d,e[5]=l,e[6]=x,e[7]=m,e[8]=o,e[9]=s,e[10]=p}else n=e[3],d=e[4],l=e[5],x=e[6],m=e[7],o=e[8],s=e[9],p=e[10];let u;e[23]!==d?(u=t.jsx("span",{className:"font-bold text-gray-900",children:d}),e[23]=d,e[24]=u):u=e[24];let N;e[25]!==n.maxPoints||e[26]!==u?(N=t.jsxs("span",{className:"text-sm text-gray-500",children:["Score:"," ",u," ","/ ",n.maxPoints]}),e[25]=n.maxPoints,e[26]=u,e[27]=N):N=e[27];let h;e[28]!==l||e[29]!==x||e[30]!==N?(h=t.jsxs("div",{className:l,children:[x,N]}),e[28]=l,e[29]=x,e[30]=N,e[31]=h):h=e[31];let j;e[32]!==m||e[33]!==h?(j=t.jsx("div",{className:m,children:h}),e[32]=m,e[33]=h,e[34]=j):j=e[34];let b;return e[35]!==j||e[36]!==o||e[37]!==s||e[38]!==p?(b=t.jsxs("div",{className:o,children:[s,p,j]}),e[35]=j,e[36]=o,e[37]=s,e[38]=p,e[39]=b):b=e[39],b};function Oe({assessment:i,attempt:e}){const[r,c]=T.useState(e.answers),a=T.useMemo(()=>r.reduce((o,s)=>(o[s.question_id]=o[s.question_id]||[],o[s.question_id].push(s),o),{}),[r]),n=(o,s)=>{c(p=>p.map(u=>u.question_id===o?{...u,manual_score:s}:u))};console.log(i);const d=async()=>{const o=r.map(s=>({question_id:s.question_id,manual_score:s.manual_score??0}));console.log(o);try{await fetch(q("instructor.classes.subjects.assessments.students.store",{class:1,subject:1,assessment:i.id,student:e.student_id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":token||""},body:JSON.stringify({scores:o})}),F.success("Scores submitted successfully!")}catch(s){console.error(s),F.error("Failed to submit scores.")}},l=i.questions.reduce((o,s)=>o+parseFloat(s.point),0),x=i.questions.reduce((o,s)=>{const p=a[s.id]||[],u=p[0]?.manual_score;return o+(u??$(s,p).earnedPoints)},0),m=[{title:"Dashboard",href:"/dashboard"},{title:"Assessments",href:"/assessments"},{title:i.title,href:"#"}];return t.jsxs(M,{breadcrumbs:m,children:[t.jsx(L,{title:`Results: ${i.title}`}),t.jsxs("div",{className:"mx-auto mt-6 max-w-5xl space-y-8 pb-12",children:[t.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm sm:p-8",children:t.jsxs("div",{className:"flex flex-col justify-between gap-6 md:flex-row md:items-start",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-extrabold text-gray-900",children:i.title}),t.jsx("p",{className:"mt-2 max-w-2xl text-gray-500",children:i.description}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-4",children:[t.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[t.jsx("span",{className:"mr-2 font-medium",children:"Status:"}),t.jsx("span",{className:"rounded-md bg-blue-100 px-2 py-0.5 text-xs font-bold tracking-wide text-blue-700 uppercase",children:e.status})]}),t.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[t.jsx("span",{className:"mr-2 font-medium",children:"Submitted:"}),e.updated_at?E(e.updated_at).format("MMM D, YYYY h:mm A"):"N/A"]})]})]}),t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"sticky bottom-6 z-50 flex min-w-[140px] flex-col items-center rounded-xl border border-gray-100 bg-gray-50 p-4 shadow-lg transition-all duration-500 ease-in-out",children:[t.jsx("span",{className:"mb-1 text-xs font-semibold tracking-wider text-gray-500 uppercase",children:"Total Score"}),t.jsxs("div",{className:"text-4xl font-black text-gray-900",children:[x.toFixed(0),t.jsxs("span",{className:"text-lg font-medium text-gray-400",children:["/",l.toFixed(0)]})]}),t.jsxs("div",{className:"mt-1 text-xs font-medium text-green-600",children:[(x/l*100).toFixed(1),"%"]})]})})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"px-2 text-xl font-bold text-gray-900",children:"Detailed Breakdown"}),i.questions.map((o,s)=>t.jsxs(O,{className:"transition-shadow hover:shadow-md",children:[t.jsxs(Q,{className:"flex items-center justify-between py-3",children:[t.jsxs("span",{className:"font-bold text-gray-500",children:["Question ",s+1]}),t.jsx("span",{className:"rounded border bg-white px-2 py-1 font-mono text-xs text-gray-400",children:o.type.replace("_"," ").toUpperCase()})]}),t.jsx(R,{children:t.jsx(D,{question:o,answers:a[o.id]||[],onTeacherScore:n})})]},o.id)),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:d,className:"rounded bg-blue-600 px-6 py-2 text-white transition-colors hover:bg-blue-700",children:"Submit Scores"})})]})]})]})}function J(i){return i.option_text}function K(i,e){return t.jsx("li",{children:i},e)}export{Oe as default};
