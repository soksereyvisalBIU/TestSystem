import{d as Z,a as r,u as _,j as e}from"./app-BEjprfpt.js";import{Q as q}from"./QuestionRenderer-Dh11ABnV.js";import{B as w}from"./badge-DVoRCxHz.js";import{B as l}from"./button-DGod-GTx.js";import{d as L,c as E,D as O,b as A,a as ee,e as F}from"./dialog-isigwEAQ.js";import{P as se}from"./progress-pIsaJNP-.js";import{c}from"./utils-CFcDjcb_.js";import{s as te}from"./index-ikzcNs2d.js";import{C as N}from"./circle-check-big-CHLcruy6.js";import{L as re}from"./layout-dashboard-DUA9dB13.js";import{W as ae,C as ie}from"./wifi-rWt9SZr4.js";import{W as ne}from"./wifi-off-DIg3AjCu.js";import{C as Q}from"./clock-C_uYab5X.js";import{L as le}from"./list-ordered-DTA-Wd7A.js";import{I as oe}from"./info-BTUJ9Bxo.js";import{S as de}from"./search-BL-QF0Rx.js";import{C as ce}from"./chevron-right-CrOEsWah.js";import{T as me}from"./type-lmHtqj6c.js";import{M as xe}from"./minimize-2-BroOmmCK.js";import{M as pe}from"./maximize-2-DCf6e0vk.js";import{S as he}from"./save-DPqs5y9_.js";import{T as ue}from"./triangle-alert-CyUuJg7R.js";import"./app-C2HJU6IN.js";import"./hard-drive-CgBG-Mr3.js";import"./createLucideIcon-SD458vc9.js";import"./image-mFkxl4qo.js";import"./loader-circle-bmERupY8.js";import"./upload-DcndAHuz.js";import"./file-BoRE40qY.js";import"./circle-check-D0q-_Uz_.js";import"./x-9rjc8L--.js";import"./chevron-left-D86TscZg.js";import"./textarea-CgG8HGNy.js";import"./label-tp4e9AWt.js";import"./index-rsEto4aw.js";import"./index-joJZZ6T8.js";import"./circle-alert-BPPGSlpv.js";import"./command-CmqXW0w-.js";import"./index-Db_ipX0A.js";import"./index-CVovHSZ1.js";import"./popover-B1sOJ-pt.js";import"./index-DsHUgfkw.js";import"./index-DH1X2cpJ.js";import"./index-DU3jUZ6J.js";import"./index-Brhvp-qm.js";import"./index-Bnui9FJL.js";import"./index-Da8MCGzP.js";import"./arrow-right-C6kumotC.js";import"./chevron-up-CElMC7bz.js";import"./grip-horizontal-CFTbVEEG.js";import"./circle-help-C5KnjDZQ.js";import"./index-CBL-cnJN.js";import"./index-dA-rYMbt.js";import"./index-DjAg5VJJ.js";import"./circle-DWGOQ8bk.js";import"./index-BGw31R_0.js";import"./index-CI6TeYZF.js";import"./with-selector-D5OwMqhf.js";import"./index-BYiI1tkd.js";import"./select-B9AeDQUe.js";import"./index-COWxmS2u.js";import"./check-DNy6Q5Gp.js";import"./list-D283kaZy.js";import"./circle-x-CsKtQwFL.js";import"./index-sZL0LmKN.js";import"./index-CHXMgrNC.js";const fe=i=>{const o=Math.floor(i/3600),p=Math.floor(i%3600/60),h=i%60;return[o,p,h].map(j=>j.toString().padStart(2,"0")).join(":")};function Rs({assessment:i,questions:o,student_assessment_attempt_id:p,studentAssessmentAttempt:h}){const{props:j}=Z(),v=i.subjects[0],d=h.status!=="draft",u=`exam_draft_${p}`,[a,k]=r.useState({}),[y,Y]=r.useState(!0),[B,S]=r.useState(!1),[m,W]=r.useState(!1),[P,$]=r.useState(16),[z,H]=r.useState(!1),[C,J]=r.useState(null),[K,f]=r.useState(!1),[V,g]=r.useState(!1),M=r.useRef({}),R=_({answers:{},user_id:j?.auth?.user?.id});r.useEffect(()=>{const s=()=>Y(navigator.onLine);window.addEventListener("online",s),window.addEventListener("offline",s);const t=localStorage.getItem(u);if(t)try{k(JSON.parse(t))}catch(b){console.error("Sync error",b)}const n=b=>{d||(b.preventDefault(),b.returnValue="")};return window.addEventListener("beforeunload",n),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",s),window.removeEventListener("beforeunload",n)}},[u,d]);const G=()=>{if(d||!i.duration)return 0;const s=new Date(h.started_at).getTime(),t=i.duration*60;return Math.max(0,t-Math.floor((Date.now()-s)/1e3))},[I,U]=r.useState(G());r.useEffect(()=>{if(d)return;const s=setInterval(()=>{U(t=>t<=1?(clearInterval(s),T(),0):t-1)},1e3);return()=>clearInterval(s)},[d]);const X=(s,t)=>{if(d)return;S(!0);const n={...a,[s]:t};k(n),localStorage.setItem(u,JSON.stringify(n)),setTimeout(()=>S(!1),500)},T=()=>{R.transform(s=>({...s,answers:a})),R.post(te("student.classes.subjects.assessments.attempt.store",{class_id:v.class_id,subject_id:v.id,assessment_id:i.id,student_assessment_attempt_id:p}),{onSuccess:()=>localStorage.removeItem(u)})},D=s=>{M.current[s]?.scrollIntoView({behavior:"smooth",block:"center"}),J(s)},x=r.useMemo(()=>{const s=o.data.length,t=Object.keys(a).filter(n=>a[n]!==null&&a[n]!=="").length;return{total:s,answered:t,progress:t/s*100,remaining:s-t}},[a,o.data]);return d?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-slate-50 p-6",children:e.jsxs("div",{className:"w-full max-w-md rounded-[3rem] border bg-white p-12 text-center shadow-2xl",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-24 w-24 items-center justify-center rounded-full bg-green-100",children:e.jsx(N,{className:"h-12 w-12 text-green-600"})}),e.jsx("h1",{className:"text-3xl font-black text-slate-900",children:"Submitted!"}),e.jsx("p",{className:"mt-4 font-medium text-slate-500",children:"Your assessment has been recorded and is ready for grading."}),e.jsxs(l,{className:"mt-8 w-full rounded-2xl py-7 text-lg",variant:"default",children:[e.jsx(re,{className:"mr-2 h-5 w-5"})," Return to Dashboard"]})]})}):e.jsxs("div",{className:c("min-h-screen transition-all duration-500",z?"bg-zinc-950 text-white":"bg-slate-50/50 text-slate-900"),style:{fontSize:`${P}px`},children:[e.jsx("header",{className:"sticky top-0 z-50 w-full border-b bg-white/90 shadow-sm backdrop-blur-xl dark:bg-zinc-900/90",children:e.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between px-4 py-3",children:[e.jsx("div",{className:"flex items-center gap-6",children:e.jsxs("div",{className:"hidden md:block",children:[e.jsx("span",{className:"text-[10px] font-black tracking-widest text-slate-400 uppercase",children:"Completion"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{value:x.progress,className:"h-2.5 w-32 md:w-48"}),e.jsxs("span",{className:"text-sm font-bold",children:[x.answered,"/",x.total]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl bg-slate-100 px-4 py-2 dark:bg-zinc-800",children:[y?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden text-[10px] font-black uppercase md:inline",children:"Online"})]}):e.jsxs("div",{className:"flex animate-pulse items-center gap-2 text-red-500",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{className:"text-[10px] font-black uppercase",children:"Offline Mode"})]}),e.jsx("div",{className:"h-4 w-px bg-slate-300 dark:bg-zinc-700"}),e.jsxs("div",{className:c("flex items-center gap-2 font-mono font-bold",I<300?"animate-pulse text-red-500":"text-slate-700 dark:text-zinc-300"),children:[e.jsx(Q,{className:"h-4 w-4"})," ",fe(I)]})]}),e.jsx(l,{onClick:()=>f(!0),disabled:!y,className:"rounded-xl px-6 font-bold shadow-lg shadow-primary/20",children:"Finish"})]})}),e.jsxs("div",{className:"mx-auto flex max-w-7xl gap-8 px-4 py-8",children:[!m&&e.jsx("aside",{className:"sticky top-24 hidden h-fit w-72 lg:block",children:e.jsxs("div",{className:"rounded-[2rem] border border-slate-200 bg-white p-6 shadow-sm dark:border-zinc-800 dark:bg-zinc-900",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-xs font-black tracking-widest text-slate-400 uppercase",children:[e.jsx(le,{className:"h-4 w-4"})," Navigation"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:o.data.map((s,t)=>e.jsx("button",{onClick:()=>D(s.id),className:c("flex h-12 items-center justify-center rounded-xl border text-sm font-bold transition-all",C===s.id?"scale-110 border-primary bg-primary text-white shadow-lg shadow-primary/30":a[s.id]?"border-green-100 bg-green-50 text-green-600 dark:border-green-800 dark:bg-green-900/20":"border-slate-100 bg-white text-slate-400 hover:border-slate-300 dark:border-zinc-700 dark:bg-zinc-800"),children:t+1},s.id))}),e.jsxs("div",{className:"mt-8 space-y-3 border-t pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs font-bold",children:[e.jsx("span",{className:"text-slate-400",children:"Auto-Save Status:"}),B?e.jsx("span",{className:"flex animate-pulse items-center gap-1 text-primary",children:"Syncing"}):e.jsx("span",{className:"flex items-center gap-1 text-green-500",children:"Safe"})]}),e.jsx("p",{className:"text-[10px] leading-relaxed text-slate-400 italic",children:"Answers are encrypted and saved to your local browser storage for safety."})]})]})}),e.jsxs("main",{className:c("flex-1 space-y-10 pb-32 transition-all duration-700",m?"mx-auto max-w-3xl":""),children:[e.jsxs("div",{className:"rounded-[2.5rem] border border-slate-100 bg-white p-10 shadow-sm dark:border-zinc-800 dark:bg-zinc-900",children:[e.jsx("h1",{className:"text-4xl font-black tracking-tight",children:i.title}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[e.jsxs(w,{variant:"secondary",className:"rounded-lg px-3 py-1 font-bold",children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"})," ",o.data.length," Questions"]}),e.jsxs(w,{variant:"secondary",className:"rounded-lg px-3 py-1 font-bold",children:[e.jsx(Q,{className:"mr-1.5 h-3.5 w-3.5"})," ",i.duration," Minutes Total"]})]})]}),e.jsx("div",{className:"space-y-12",children:o.data.map((s,t)=>e.jsxs("section",{ref:n=>M.current[s.id]=n,className:c("relative rounded-[3rem] border p-10 transition-all duration-500",C===s.id?"border-primary bg-white shadow-2xl ring-8 ring-primary/5 dark:bg-zinc-900":"border-slate-200 bg-white/60 dark:border-zinc-800 dark:bg-zinc-900/50"),children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs(w,{className:"rounded-full bg-slate-900 px-5 py-1.5 text-xs font-black tracking-tighter uppercase shadow-lg",children:["Question ",t+1]}),a[s.id]&&e.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-green-50 px-3 py-1 text-[10px] font-black text-green-600 uppercase dark:bg-green-900/30",children:[e.jsx(N,{className:"h-3 w-3"})," ","Recorded"]})]}),e.jsx(q,{question:s,index:t,answer:a[s.id],onAnswerChange:X,disabled:d})]},s.id))}),e.jsxs("div",{className:"rounded-[3rem] border-4 border-dashed border-slate-200 p-16 text-center dark:border-zinc-800",children:[e.jsx("h2",{className:"text-3xl font-black text-slate-800 dark:text-zinc-200",children:"All set?"}),e.jsx("p",{className:"mt-3 font-medium text-slate-500",children:"Review your questions one last time before submitting."}),e.jsxs("div",{className:"mt-10 flex flex-col items-center justify-center gap-4 sm:flex-row",children:[e.jsxs(l,{variant:"outline",size:"lg",onClick:()=>g(!0),className:"h-16 rounded-2xl border-2 px-8 text-lg font-bold",children:[e.jsx(de,{className:"mr-2 h-5 w-5"})," Review Summary"]}),e.jsxs(l,{size:"lg",onClick:()=>f(!0),className:"h-16 rounded-2xl px-12 text-lg font-black shadow-xl",children:["Final Submit"," ",e.jsx(ce,{className:"ml-2 h-6 w-6"})]})]})]})]})]}),e.jsx("div",{className:"fixed right-8 bottom-8 z-50 flex flex-col gap-3",children:e.jsxs("div",{className:"flex flex-col gap-2 rounded-3xl border border-slate-200 bg-white/80 p-2 shadow-2xl backdrop-blur-xl dark:border-zinc-700 dark:bg-zinc-800/80",children:[e.jsx(l,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-2xl hover:bg-slate-100",onClick:()=>$(s=>Math.min(s+2,24)),children:e.jsx(me,{className:"h-5 w-5"})}),e.jsx(l,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-2xl hover:bg-slate-100",onClick:()=>H(!z),children:e.jsx(ie,{className:"h-5 w-5"})}),e.jsx(l,{variant:"ghost",size:"icon",className:c("h-12 w-12 rounded-2xl",m&&"bg-primary text-white hover:bg-primary/90"),onClick:()=>W(!m),children:m?e.jsx(xe,{className:"h-5 w-5"}):e.jsx(pe,{className:"h-5 w-5"})})]})}),e.jsx(L,{open:K,onOpenChange:f,children:e.jsxs(E,{className:"rounded-[2.5rem] p-10",children:[e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-primary/10",children:e.jsx(he,{className:"h-10 w-10 text-primary"})}),e.jsx(A,{className:"text-3xl font-black",children:"Ready to finish?"}),e.jsx(ee,{className:"pt-2 text-lg",children:x.remaining>0?`Careful! You still have ${x.remaining} unanswered questions.`:"You've answered all questions. Your work will be submitted for grading."})]}),e.jsxs(F,{className:"mt-8 gap-3 sm:justify-center",children:[e.jsx(l,{variant:"outline",className:"h-14 rounded-xl px-8 font-bold",onClick:()=>f(!1),children:"Keep Working"}),e.jsx(l,{className:"h-14 rounded-xl px-8 font-bold",onClick:T,children:"Yes, Submit Now"})]})]})}),e.jsx(L,{open:V,onOpenChange:g,children:e.jsxs(E,{className:"max-w-2xl rounded-[2.5rem] p-10",children:[e.jsx(O,{children:e.jsx(A,{className:"text-2xl font-black",children:"Review Summary"})}),e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4",children:o.data.map((s,t)=>e.jsxs("button",{onClick:()=>{g(!1),D(s.id)},className:c("flex flex-col items-center gap-1 rounded-2xl border-2 p-4 transition-all",a[s.id]?"border-green-500 bg-green-50/50":"border-red-200 bg-red-50/50"),children:[e.jsxs("span",{className:"text-xs font-black text-slate-400 uppercase",children:["Q.",t+1]}),a[s.id]?e.jsx(N,{className:"h-5 w-5 text-green-600"}):e.jsx(ue,{className:"h-5 w-5 text-red-500"})]},s.id))}),e.jsx(F,{className:"mt-8",children:e.jsx(l,{className:"h-14 w-full rounded-xl font-bold",onClick:()=>g(!1),children:"Return to Test"})})]})})]})}export{Rs as default};
