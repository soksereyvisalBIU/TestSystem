import{d as F,r as h,u as U,j as t,c as S}from"./app-DOexATz8.js";import{s as W}from"./index-ikzcNs2d.js";import{c as y}from"./utils-CFcDjcb_.js";import{Q as z}from"./QuestionRenderer-CXH3MBWS.js";import{B as O}from"./badge-CPBjG4_l.js";import{B as w}from"./button-BRVN6i6H.js";import{P as V}from"./progress-AFqel70o.js";import{D as B,a as E,b as M,e as R,c as T,d as $}from"./dialog-TFrJjmZh.js";import{S as Y}from"./save-U6aSdv-D.js";import{C as Q}from"./circle-check-big-DiLSee33.js";import{C as G}from"./clock-JNa168ul.js";import{T as H}from"./triangle-alert-P1pcZk7Y.js";import"./app-Dkd-uU77.js";import"./hard-drive-C7ThFyw9.js";import"./createLucideIcon-j6D0D3Y_.js";import"./image-CZbZ8_rj.js";import"./maximize-2-O5BVre8P.js";import"./loader-circle-xDQqgRtj.js";import"./upload-C5XbYVl2.js";import"./file-iwSUTVYm.js";import"./circle-check-BbXVY_J9.js";import"./x-xRkXIo8D.js";import"./chevron-left-BwAIY23A.js";import"./chevron-right-CqdRtJ2F.js";import"./textarea-BsNou_JT.js";import"./label-B8z-0cNd.js";import"./index-CsaJF3T3.js";import"./index-Dghi0PCu.js";import"./circle-alert-_35u1DpG.js";import"./command-BJUssI3G.js";import"./index-BiXTY-N1.js";import"./index-DM2N5xoF.js";import"./search-BJrQLS36.js";import"./popover-C4Np6-RM.js";import"./index-BZcpqnGn.js";import"./index-BEPutMgU.js";import"./index-CbEB6B2s.js";import"./index-DI0Uf7dS.js";import"./index-CPEYA-OZ.js";import"./index-D8NCBvGj.js";import"./arrow-right-Cr5VBfnV.js";import"./chevron-up-_obE1ikU.js";import"./grip-horizontal-BNCbtw4K.js";import"./circle-help-a1QgAAb2.js";import"./index-Z9JsAk8n.js";import"./index-D2V0qVjz.js";import"./index-BF4E9qjg.js";import"./circle-BdnuV9lG.js";import"./index-DTzCHv86.js";import"./index-C5FbGKEL.js";import"./with-selector-CQBRQGj8.js";import"./index-BCjrxXRD.js";import"./select-CH_F3wFZ.js";import"./index-C8DTQ8L6.js";import"./check-B5V9zjb2.js";import"./list-CH_oBRHj.js";import"./type-Ce9inCyE.js";import"./info-CrSviemM.js";import"./circle-x-Bx2T49Oq.js";import"./index-DQ5CcXw7.js";import"./index-CHXMgrNC.js";const J=m=>{const e=Math.floor(m/3600),o=Math.floor(m%3600/60),i=m%60;return`${e>0?e+":":""}${o.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`};function nt({assessment:m,questions:e,studentAssessmentAttempt:o,student_assessment_attempt_id:i}){const{props:f}=F(),l=m.subjects[0],a=o.status!=="draft",[r,c]=h.useState({}),[n,x]=h.useState(null),[p,u]=h.useState(!1),[b,N]=h.useState(!1),D=h.useRef({}),A=U({answers:{},user_id:f?.auth?.user?.id}),[C,P]=h.useState(()=>{if(a||!m.duration)return 0;const s=new Date(o.started_at).getTime(),d=Math.floor((Date.now()-s)/1e3);return Math.max(0,m.duration*60-d)});h.useEffect(()=>{if(a||C<=0)return;const s=setInterval(()=>{P(d=>d<=1?(clearInterval(s),I(),0):d-1)},1e3);return()=>clearInterval(s)},[a]),h.useEffect(()=>{const s=new IntersectionObserver(d=>{d.forEach(g=>{if(g.isIntersecting){const k=parseInt(g.target.id.replace("q-",""));x(k)}})},{threshold:.6,rootMargin:"-10% 0px -70% 0px"});return Object.values(D.current).forEach(d=>d&&s.observe(d)),()=>s.disconnect()},[e.data]);const j=h.useMemo(()=>{const s=e.data.length,d=e.data.filter(k=>{const v=r[k.id];return v!=null&&v!==""&&(!Array.isArray(v)||v.length>0)}).length,g=d/s*100;return{total:s,answeredCount:d,progress:g}},[r,e.data]),_=(s,d)=>{a||c(g=>({...g,[s]:d}))},I=()=>{A.transform(s=>({...s,answers:r})),A.post(W("student.classes.subjects.assessments.attempt.store",{class_id:l.class_id,subject_id:l.id,assessment_id:m.id,student_assessment_attempt_id:i}))},L=()=>{e.data.filter(d=>!r[d.id]).length>0?N(!0):u(!0)};return a?t.jsx(K,{date:o.updated_at}):t.jsxs("div",{className:"min-h-screen bg-slate-50/50 dark:bg-slate-950",children:[t.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-md border-b dark:bg-slate-900/80",children:t.jsxs("div",{className:"flex items-center justify-between px-6 py-3 max-w-[1600px] mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("span",{className:"text-sm font-bold text-primary",children:"Progress"}),t.jsx(V,{value:j.progress,className:"w-40 h-2"}),t.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[j.answeredCount," / ",j.total," Answered"]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(O,{variant:"outline",className:"hidden sm:flex bg-white",children:["Draft Saved ",t.jsx(Y,{className:"ml-2 h-3 w-3 text-green-500"})]})})]})}),t.jsxs("div",{className:"flex pt-14",children:[t.jsxs("aside",{className:"fixed left-0 top-14 hidden h-[calc(100vh-3.5rem)] w-72 overflow-y-auto border-r bg-white p-6 lg:block dark:bg-slate-900",children:[t.jsx("div",{className:"mb-6",children:t.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-muted-foreground",children:"Navigator"})}),t.jsx("div",{className:"grid grid-cols-4 gap-2",children:e.data.map((s,d)=>t.jsx("button",{onClick:()=>document.getElementById(`q-${s.id}`)?.scrollIntoView({behavior:"smooth"}),className:y("flex h-10 w-10 items-center justify-center rounded-lg border text-sm font-bold transition-all",n===s.id?"border-primary bg-primary text-white ring-4 ring-primary/10":r[s.id]?"bg-green-100 border-green-200 text-green-700 dark:bg-green-900/30":"bg-slate-50 hover:bg-slate-100"),children:d+1},s.id))}),t.jsx("div",{className:"mt-10 border-t pt-6",children:t.jsx(w,{className:"w-full shadow-lg",onClick:L,children:"Finish Assessment"})})]}),t.jsx("main",{className:"flex-1 lg:ml-72 pb-32",children:t.jsxs("div",{className:"mx-auto max-w-3xl px-6 py-12",children:[t.jsxs("div",{className:"mb-12 text-center",children:[t.jsx("h1",{className:"text-4xl font-black tracking-tight text-slate-900 dark:text-white",children:m.title}),t.jsx("p",{className:"mt-4 text-lg text-slate-500",children:m.description})]}),t.jsx("div",{className:"space-y-12",children:e.data.map((s,d)=>t.jsxs("section",{id:`q-${s.id}`,ref:g=>D.current[s.id]=g,className:y("group relative rounded-3xl border bg-white p-8 shadow-sm transition-all duration-500 dark:bg-slate-900",n===s.id?"border-primary shadow-2xl ring-1 ring-primary/5":"border-slate-200"),children:[t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsxs(O,{variant:"secondary",className:"px-3 py-1 text-xs font-bold uppercase",children:["Question ",d+1]}),r[s.id]&&t.jsx(Q,{className:"h-5 w-5 text-green-500"})]}),s.image_url&&t.jsx("div",{className:"mb-6 overflow-hidden rounded-xl border bg-slate-100",children:t.jsx("img",{src:s.image_url,alt:"Question visual",className:"max-h-80 w-full object-contain"})}),t.jsx("div",{className:"prose prose-slate mb-8 dark:prose-invert",children:t.jsx("h2",{className:"text-xl font-semibold leading-relaxed text-slate-800 dark:text-slate-100",children:s.question})}),t.jsx("div",{className:"rounded-2xl bg-slate-50/50 p-4 dark:bg-slate-800/50",children:t.jsx(z,{question:s,answer:r[s.id],onAnswerChange:_,disabled:a})})]},s.id))})]})}),t.jsxs("div",{className:y("fixed bottom-6 right-6 z-50 flex flex-col items-center rounded-2xl border-4 border-white bg-white/90 p-4 shadow-2xl backdrop-blur transition-all dark:bg-slate-900/90 dark:border-slate-800",C<300?"text-red-600 animate-pulse":"text-slate-900 dark:text-white"),children:[t.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest opacity-60",children:[t.jsx(G,{className:"h-3 w-3"})," Time Remaining"]}),t.jsx("div",{className:"font-mono text-3xl font-black",children:J(C)})]})]}),t.jsx(X,{isOpen:p,onClose:()=>u(!1),onConfirm:I,stats:j}),t.jsx(Z,{isOpen:b,onClose:()=>N(!1),onConfirm:()=>{N(!1),u(!0)},unansweredCount:j.total-j.answeredCount})]})}function K(m){const e=S.c(12),{date:o}=m;let i,f;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx("div",{className:"mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-green-100",children:t.jsx(Q,{className:"h-10 w-10 text-green-600"})}),f=t.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Assessment Submitted"}),e[0]=i,e[1]=f):(i=e[0],f=e[1]);let l;e[2]!==o?(l=new Date(o).toLocaleDateString(),e[2]=o,e[3]=l):l=e[3];let a;e[4]!==o?(a=new Date(o).toLocaleTimeString(),e[4]=o,e[5]=a):a=e[5];let r;e[6]!==l||e[7]!==a?(r=t.jsxs("p",{className:"mt-3 text-slate-500",children:["Recorded on ",l," at ",a]}),e[6]=l,e[7]=a,e[8]=r):r=e[8];let c;e[9]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx(w,{className:"mt-8 w-full",variant:"outline",children:"Back to Dashboard"}),e[9]=c):c=e[9];let n;return e[10]!==r?(n=t.jsx("div",{className:"flex min-h-screen items-center justify-center bg-slate-50 p-4",children:t.jsxs("div",{className:"w-full max-w-md rounded-3xl bg-white p-10 text-center shadow-xl",children:[i,f,r,c]})}),e[10]=r,e[11]=n):n=e[11],n}function X(m){const e=S.c(18),{isOpen:o,onClose:i,onConfirm:f,stats:l}=m;let a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(M,{children:"Submit Assessment?"}),e[0]=a):a=e[0];let r;e[1]!==l.answeredCount||e[2]!==l.total?(r=t.jsxs(B,{children:[a,t.jsxs(E,{children:["You have answered ",l.answeredCount," out of ",l.total," questions. Once submitted, you cannot change your answers."]})]}),e[1]=l.answeredCount,e[2]=l.total,e[3]=r):r=e[3];let c;e[4]!==i?(c=t.jsx(w,{variant:"ghost",onClick:i,children:"Review Answers"}),e[4]=i,e[5]=c):c=e[5];let n;e[6]!==f?(n=t.jsx(w,{onClick:f,children:"Confirm Submission"}),e[6]=f,e[7]=n):n=e[7];let x;e[8]!==c||e[9]!==n?(x=t.jsxs(R,{className:"gap-2 sm:gap-0",children:[c,n]}),e[8]=c,e[9]=n,e[10]=x):x=e[10];let p;e[11]!==r||e[12]!==x?(p=t.jsxs(T,{children:[r,x]}),e[11]=r,e[12]=x,e[13]=p):p=e[13];let u;return e[14]!==o||e[15]!==i||e[16]!==p?(u=t.jsx($,{open:o,onOpenChange:i,children:p}),e[14]=o,e[15]=i,e[16]=p,e[17]=u):u=e[17],u}function Z(m){const e=S.c(18),{isOpen:o,onClose:i,onConfirm:f,unansweredCount:l}=m;let a,r;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:t.jsx(H,{className:"h-6 w-6 text-red-600"})}),r=t.jsx(M,{className:"text-center text-red-600",children:"Incomplete Assessment"}),e[0]=a,e[1]=r):(a=e[0],r=e[1]);let c;e[2]!==l?(c=t.jsxs(B,{children:[a,r,t.jsxs(E,{className:"text-center",children:["You still have ",t.jsx("strong",{children:l})," questions without answers. Are you sure you want to proceed?"]})]}),e[2]=l,e[3]=c):c=e[3];let n;e[4]!==i?(n=t.jsx(w,{variant:"outline",onClick:i,className:"w-full",children:"Go Back"}),e[4]=i,e[5]=n):n=e[5];let x;e[6]!==f?(x=t.jsx(w,{variant:"destructive",onClick:f,className:"w-full",children:"Submit Anyway"}),e[6]=f,e[7]=x):x=e[7];let p;e[8]!==n||e[9]!==x?(p=t.jsxs(R,{className:"flex-col gap-2 sm:flex-row",children:[n,x]}),e[8]=n,e[9]=x,e[10]=p):p=e[10];let u;e[11]!==c||e[12]!==p?(u=t.jsxs(T,{className:"border-red-100",children:[c,p]}),e[11]=c,e[12]=p,e[13]=u):u=e[13];let b;return e[14]!==o||e[15]!==i||e[16]!==u?(b=t.jsx($,{open:o,onOpenChange:i,children:u}),e[14]=o,e[15]=i,e[16]=u,e[17]=b):b=e[17],b}export{nt as default};
