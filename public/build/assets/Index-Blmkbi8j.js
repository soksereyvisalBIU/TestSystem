import{Y as D,i as Ne,n as Ce,r as g,e as Re,j as o,c as Ee,m as ne,A as ke}from"./app-FX2mCU7_.js";import{c as Me}from"./utils-CFcDjcb_.js";import{s as oe}from"./index-ikzcNs2d.js";import{Q as _e}from"./QuestionRenderer-DG3nSWwW.js";import{c as ae,a as qe,A as Le}from"./AssessmentHeader-mxGwilqw.js";import{CompletionScreen as ze}from"./CompletionScreen-RtNQ0FUz.js";import{FloatingTools as Ae}from"./FloatingTools-CqqPMpNJ.js";import{NavigationSidebar as se}from"./Navigator-BkX_2L-v.js";import{ScrollViewEndSection as Fe}from"./ScrollViewEndSection-DCZY7jaJ.js";import{SingleViewNavigation as De}from"./SingleViewNavigation-pWYkA5AG.js";import{AssessmentTitleCard as Ge}from"./AssessmentTitleCard-DsIA4mdl.js";import{QuestionCard as Qe}from"./QuestionCard-CmsdDDYF.js";import{ReviewSummaryDialog as Pe}from"./ReviewSummaryDialog-BJ3bFZn4.js";import{SubmitConfirmationDialog as Ue}from"./SubmitConfirmationDialog-4FdTa_c6.js";import{C as He}from"./circle-alert-DgK5B4CM.js";import{X as Ke}from"./x--MDhiozJ.js";/* empty css            */import"./button-D6rvrqk4.js";import"./index-Dho1BOPZ.js";import"./index-H-p-6x2L.js";import"./index-CHXMgrNC.js";import"./hard-drive-fpWqKkQ_.js";import"./createLucideIcon-DcOdjbSg.js";import"./image-CCR9Pf2x.js";import"./maximize-2-CSkTZFQG.js";import"./loader-circle-DUE_MXqK.js";import"./upload-DwEzcnG-.js";import"./file-qh796H7B.js";import"./circle-check-DVwraJO4.js";import"./chevron-left-7W4r_akD.js";import"./chevron-right-Bdl6i_r9.js";import"./textarea-CYuWAOEg.js";import"./label-DgHSu__w.js";import"./index-fDEaC8nN.js";import"./command-B1XGB4JS.js";import"./dialog-Cnbgb4eV.js";import"./index-DWdDnj1S.js";import"./index-Djh7mKN5.js";import"./index-BYz4FP8H.js";import"./index-B4g3rf-s.js";import"./index-D89LtbFz.js";import"./index-BMn85Ckv.js";import"./search-C65iRtwj.js";import"./popover-Cq2YoZzJ.js";import"./index-DLi1LZKV.js";import"./index-XY7sxlKk.js";import"./arrow-right-CUQTe1r3.js";import"./chevron-up-FNaBatrD.js";import"./grip-horizontal-BU-eu2GU.js";import"./circle-help-Bt4GZhb0.js";import"./index-D9MQFTSn.js";import"./index-DUwq3CKA.js";import"./index-CQxgamq2.js";import"./circle-CApYc5AB.js";import"./circle-check-big-Cp86NHYX.js";import"./index-BDZy2Tml.js";import"./index-C3sCVyJj.js";import"./with-selector-D5GPH9t-.js";import"./index-D2d5_wFn.js";import"./select-Ca93U3uh.js";import"./index-BRFW9oMl.js";import"./check-CvjDbgv_.js";import"./list-Be7RZyvF.js";import"./type-BxwOInJl.js";import"./info-BaFHKeWZ.js";import"./circle-x-C0IIj_tv.js";import"./progress-DaKXdc1C.js";import"./clock-BeoKzsq7.js";import"./layout-dashboard-DmhiA2ac.js";import"./tooltip-DVdBcu3d.js";import"./layout-grid-CahmFXhh.js";import"./minus-CyPoSKvV.js";import"./plus-CkcdMSKf.js";import"./sun-1c155_ts.js";import"./keyboard-CNAbmwed.js";import"./badge-BrkaWmuG.js";import"./card-85u8o2Ll.js";import"./layout-list-BhLBlEjk.js";import"./eye-D2amQP0q.js";import"./book-open-DqHgIfUq.js";import"./sparkles-CFhmcJbe.js";import"./target-BylYH0SG.js";import"./layers-D7PqIMZh.js";import"./triangle-alert-BzPfruqk.js";var P,ce;function we(){if(ce)return P;ce=1;function r(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}return P=r,P}var U,ue;function Ve(){if(ue)return U;ue=1;var r=typeof D=="object"&&D&&D.Object===Object&&D;return U=r,U}var H,le;function ye(){if(le)return H;le=1;var r=Ve(),t=typeof self=="object"&&self&&self.Object===Object&&self,n=r||t||Function("return this")();return H=n,H}var K,me;function We(){if(me)return K;me=1;var r=ye(),t=function(){return r.Date.now()};return K=t,K}var V,de;function $e(){if(de)return V;de=1;var r=/\s/;function t(n){for(var a=n.length;a--&&r.test(n.charAt(a)););return a}return V=t,V}var W,fe;function Be(){if(fe)return W;fe=1;var r=$e(),t=/^\s+/;function n(a){return a&&a.slice(0,r(a)+1).replace(t,"")}return W=n,W}var $,pe;function Ie(){if(pe)return $;pe=1;var r=ye(),t=r.Symbol;return $=t,$}var B,be;function Ze(){if(be)return B;be=1;var r=Ie(),t=Object.prototype,n=t.hasOwnProperty,a=t.toString,l=r?r.toStringTag:void 0;function d(u){var b=n.call(u,l),f=u[l];try{u[l]=void 0;var s=!0}catch{}var v=a.call(u);return s&&(b?u[l]=f:delete u[l]),v}return B=d,B}var Z,ge;function Xe(){if(ge)return Z;ge=1;var r=Object.prototype,t=r.toString;function n(a){return t.call(a)}return Z=n,Z}var X,ve;function Ye(){if(ve)return X;ve=1;var r=Ie(),t=Ze(),n=Xe(),a="[object Null]",l="[object Undefined]",d=r?r.toStringTag:void 0;function u(b){return b==null?b===void 0?l:a:d&&d in Object(b)?t(b):n(b)}return X=u,X}var Y,he;function Je(){if(he)return Y;he=1;function r(t){return t!=null&&typeof t=="object"}return Y=r,Y}var J,xe;function et(){if(xe)return J;xe=1;var r=Ye(),t=Je(),n="[object Symbol]";function a(l){return typeof l=="symbol"||t(l)&&r(l)==n}return J=a,J}var ee,Se;function tt(){if(Se)return ee;Se=1;var r=Be(),t=we(),n=et(),a=NaN,l=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,u=/^0o[0-7]+$/i,b=parseInt;function f(s){if(typeof s=="number")return s;if(n(s))return a;if(t(s)){var v=typeof s.valueOf=="function"?s.valueOf():s;s=t(v)?v+"":v}if(typeof s!="string")return s===0?s:+s;s=r(s);var j=d.test(s);return j||u.test(s)?b(s.slice(2),j?2:8):l.test(s)?a:+s}return ee=f,ee}var te,je;function rt(){if(je)return te;je=1;var r=we(),t=We(),n=tt(),a="Expected a function",l=Math.max,d=Math.min;function u(b,f,s){var v,j,E,I,c,S,h=0,k=!1,N=!1,w=!0;if(typeof b!="function")throw new TypeError(a);f=n(f)||0,r(s)&&(k=!!s.leading,N="maxWait"in s,E=N?l(n(s.maxWait)||0,f):E,w="trailing"in s?!!s.trailing:w);function M(m){var e=v,i=j;return v=j=void 0,h=m,I=b.apply(i,e),I}function A(m){return h=m,c=setTimeout(_,f),k?M(m):I}function x(m){var e=m-S,i=m-h,p=f-e;return N?d(p,E-i):p}function T(m){var e=m-S,i=m-h;return S===void 0||e>=f||e<0||N&&i>=E}function _(){var m=t();if(T(m))return q(m);c=setTimeout(_,x(m))}function q(m){return c=void 0,w&&v?M(m):(v=j=void 0,I)}function G(){c!==void 0&&clearTimeout(c),h=0,v=S=j=c=void 0}function F(){return c===void 0?I:q(t())}function O(){var m=t(),e=T(m);if(v=arguments,j=this,S=m,e){if(c===void 0)return A(S);if(N)return clearTimeout(c),c=setTimeout(_,f),M(S)}return c===void 0&&(c=setTimeout(_,f)),I}return O.cancel=G,O.flush=F,O}return te=u,te}var it=rt();const nt=Ne(it);function zr({assessment:r,questions:t,student_assessment_attempt_id:n,studentAssessmentAttempt:a}){const{props:l}=Ce(),d=r.subjects[0],u=a.status!=="draft",b=g.useMemo(()=>`exam_draft_${n}`,[n]),[f,s]=g.useState({}),[v,j]=g.useState(typeof navigator<"u"?navigator.onLine:!0),[E,I]=g.useState(!1),[c,S]=g.useState({mode:"scroll",focusMode:!1,fontSize:16}),[h,k]=g.useState({activeId:null,currentIndex:0,isMobileOpen:!1}),[N,w]=g.useState({submit:!1,review:!1}),M=g.useRef({}),A=g.useRef(!1),x=Re({answers:{},user_id:l?.auth?.user?.id}),T=g.useMemo(()=>nt(e=>{localStorage.setItem(b,JSON.stringify(e)),I(!1)},1500),[b]);g.useEffect(()=>()=>T.cancel(),[T]);const _=g.useCallback((e,i)=>{u||x.processing||(I(!0),s(p=>{const C={...p,[e]:i};return T(C),C}))},[u,x.processing,T]),q=g.useCallback(async()=>{if(!(x.processing||A.current)){A.current=!0;try{const e={},i={};Object.entries(f).forEach(([R,y])=>{y instanceof File?e[R]=y:i[R]=y});const p={};for(const[R,y]of Object.entries(e)){const Q=Math.ceil(y.size/1048576);for(let L=0;L<Q;L++){const Te=y.slice(L*1048576,Math.min((L+1)*1048576,y.size)),z=new FormData;z.append("file",Te),z.append("chunkIndex",String(L)),z.append("totalChunks",String(Q)),z.append("fileName",y.name),z.append("questionId",R);const ie=await fetch(oe("student.classes.subjects.assessments.attempt.upload-chunk",{class_id:d.class_id,subject_id:d.id,assessment_id:r.id,student_assessment_attempt_id:n}),{method:"POST",body:z,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(!ie.ok)throw new Error("Chunk upload failed");if(L===Q-1){const Oe=await ie.json();p[R]=Oe.fileId}}}const C={...i,...p};x.transform(()=>({answers:C,user_id:l?.auth?.user?.id})),x.post(oe("student.classes.subjects.assessments.attempt.store",{class_id:d.class_id,subject_id:d.id,assessment_id:r.id,student_assessment_attempt_id:n}),{preserveScroll:!0,onSuccess:()=>{localStorage.removeItem(b),T.cancel()}})}catch(e){console.error(e),A.current=!1}}},[f,r.id,d,n,x,b,T,l?.auth?.user?.id]),[G,F]=g.useState(()=>ae(a.started_at,r.duration));g.useEffect(()=>{const e=p=>{u||(p.preventDefault(),p.returnValue="")};window.addEventListener("online",()=>j(!0)),window.addEventListener("offline",()=>j(!1)),window.addEventListener("beforeunload",e);const i=localStorage.getItem(b);return i&&s(JSON.parse(i)),()=>{window.removeEventListener("beforeunload",e)}},[b,u]),g.useEffect(()=>{if(u||x.processing)return;const e=setInterval(()=>{const i=ae(a.started_at,r.duration);i<=0?(F(0),clearInterval(e),q()):F(i)},1e3);return()=>clearInterval(e)},[r.duration,a.started_at,u,x.processing,q]);const O=g.useCallback((e,i)=>{if(!(i<0||i>=t.data.length)&&(k(p=>({...p,activeId:e,currentIndex:i,isMobileOpen:!1})),c.mode==="scroll")){const p=M.current[e];if(p){const C=p.getBoundingClientRect().top+window.scrollY-100;window.scrollTo({top:C,behavior:"smooth"})}}},[c.mode,t.data.length]),m=g.useMemo(()=>qe(f,t.data.length),[f,t.data.length]);return u?o.jsx(ze,{onReturnToDashboard:()=>window.location.href="/"}):o.jsxs("div",{className:"min-h-screen bg-slate-50/50 transition-all duration-300 dark:bg-slate-950",style:{fontSize:`${c.fontSize}px`},children:[o.jsx(Le,{stats:m,isOnline:v,isSaving:E||x.processing,timeLeft:G,onSubmit:()=>w(e=>({...e,submit:!0})),disableSubmit:!v||x.processing}),!v&&o.jsxs("div",{className:"sticky top-16 z-40 flex items-center justify-center gap-2 bg-destructive/10 px-4 py-2 text-sm text-destructive backdrop-blur-md",children:[o.jsx(He,{size:16}),"Connection lost. Progress is being saved locally."]}),o.jsxs("div",{className:"mx-auto flex max-w-7xl gap-8 px-4 py-6 sm:py-10",children:[o.jsxs("main",{className:Me("flex-1 space-y-6",c.focusMode&&"mx-auto max-w-3xl"),children:[(h.currentIndex===0||c.mode==="scroll")&&o.jsx(Ge,{title:r.title,questionCount:t.data.length}),o.jsx("div",{className:"space-y-10",children:t.data.map((e,i)=>c.mode==="single"&&i!==h.currentIndex?null:o.jsxs("div",{ref:p=>M.current[e.id]=p,children:[o.jsx(Qe,{question:e,index:i,answer:f[e.id],isActive:h.activeId===e.id||c.mode==="single",onAnswerChange:_,renderQuestion:(p,C,R,y,re)=>o.jsx(_e,{question:p,index:C,answer:R,onAnswerChange:y,disabled:re||x.processing})}),c.mode==="single"&&o.jsx(De,{currentIndex:h.currentIndex,totalQuestions:t.data.length,onPrevious:()=>O(t.data[i-1].id,i-1),onNext:()=>O(t.data[i+1].id,i+1),onSubmit:()=>w(p=>({...p,submit:!0})),isFirstQuestion:i===0,isLastQuestion:i===t.data.length-1})]},e.id))}),c.mode==="scroll"&&o.jsx(Fe,{onReview:()=>w(e=>({...e,review:!0})),onSubmit:()=>w(e=>({...e,submit:!0}))})]}),!c.focusMode&&o.jsx("aside",{className:"sticky top-24 hidden h-fit w-72 shrink-0 lg:block",children:o.jsx(se,{questions:t.data,answers:f,activeQuestionId:h.activeId,currentQuestionIndex:h.currentIndex,viewMode:c.mode,onNavigate:O,onViewModeChange:e=>S(i=>({...i,mode:e}))})})]}),o.jsx(ot,{isOpen:h.isMobileOpen,onClose:()=>k(e=>({...e,isMobileOpen:!1})),children:o.jsx(se,{questions:t.data,answers:f,activeQuestionId:h.activeId,currentQuestionIndex:h.currentIndex,viewMode:c.mode,onNavigate:O,onViewModeChange:e=>S(i=>({...i,mode:e}))})}),o.jsx(Ae,{fontSize:c.fontSize,isFocusMode:c.focusMode,onFontSizeIncrease:()=>S(e=>({...e,fontSize:Math.min(e.fontSize+2,24)})),onFontSizeDecrease:()=>S(e=>({...e,fontSize:Math.max(e.fontSize-2,12)})),onToggleFocusMode:()=>S(e=>({...e,focusMode:!e.focusMode})),onOpenNavigator:()=>k(e=>({...e,isMobileOpen:!0}))}),o.jsx(Ue,{isOpen:N.submit,onOpenChange:e=>w(i=>({...i,submit:e})),stats:m,onConfirm:q,isLoading:x.processing}),o.jsx(Pe,{isOpen:N.review,onOpenChange:e=>w(i=>({...i,review:e})),questions:t.data,answers:f,onNavigateToQuestion:O,onSubmit:()=>w({review:!1,submit:!0})})]})}function ot(r){const t=Ee.c(6),{isOpen:n,onClose:a,children:l}=r;let d;t[0]!==l||t[1]!==n||t[2]!==a?(d=n&&o.jsxs(o.Fragment,{children:[o.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 z-50 bg-slate-900/60 backdrop-blur-sm lg:hidden"}),o.jsx(ne.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25},className:"fixed inset-y-0 right-0 z-[51] w-full max-w-xs bg-white p-6 dark:bg-slate-900",children:o.jsxs("div",{className:"flex h-full flex-col",children:[o.jsxs("div",{className:"mb-6 flex items-center justify-between border-b pb-4",children:[o.jsx("h2",{className:"text-lg font-semibold",children:"Navigator"}),o.jsx("button",{onClick:a,children:o.jsx(Ke,{})})]}),o.jsx("div",{className:"flex-1 overflow-y-auto",children:l})]})})]}),t[0]=l,t[1]=n,t[2]=a,t[3]=d):d=t[3];let u;return t[4]!==d?(u=o.jsx(ke,{children:d}),t[4]=d,t[5]=u):u=t[5],u}export{zr as default};
